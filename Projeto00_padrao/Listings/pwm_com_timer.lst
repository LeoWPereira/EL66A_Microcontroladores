A51 MACRO ASSEMBLER  PWM_COM_TIMER                                                        04/11/2017 16:50:45 PAGE     1


MACRO ASSEMBLER A51 V8.2.5.0
OBJECT MODULE PLACED IN .\Objects\pwm_com_timer.obj
ASSEMBLER INVOKED BY: C:\Keil_v5\C51\BIN\A51.EXE pwm_com_timer.a51 SET(SMALL) DEBUG PRINT(.\Listings\pwm_com_timer.lst) 
                      OBJECT(.\Objects\pwm_com_timer.obj) EP

LOC  OBJ            LINE     SOURCE

                       1     

                       2     

                       3     

                       4     

                       5     

                       6     

                       7     

                       8     

                       9     

  0090                10     PWM_PORT                        EQU     P1

  0090                11     PWM_PIN                         EQU P1.0

                      12             

  0000                13     PWM_FLAG                        EQU 0    

                      14     

  0000                15     WAVE_FORM_SINE          EQU 00h

  0001                16     WAVE_FORM_SQUARE        EQU 01h

                      17     

  0031                18     WAVE_FORM                       EQU 31h  

  0032                19     DUTY_CYCLE                      EQU 32h  

                      20     

                      21     

  0033                22     PERIOD_LSB                      EQU 33h

  0034                23     PERIOD_MED                      EQU 34h 

  0035                24     PERIOD_MSB                      EQU 35h

                      25     

0000                  26     org 0000h  

0000 0200D5           27     ljmp main  

                      28     

0003                  29     org 0003h  

0003 02017F           30     ljmp INT_INT0

                      31     

000B                  32     org 000Bh  

000B 020180           33     ljmp INT_TIMER0  

                      34     

0013                  35     org 0013h  

0013 020181           36     ljmp INT_INT1  

                      37     

001B                  38     org 001Bh  

001B 020182           39     ljmp INT_TIMER1  

                      40     

0023                  41     org 0023h  

0023 020195           42     ljmp INT_SERIAL  

                      43     

                      44     

                      45     

                      46     

0050                  47     org 0050h

0050                  48     SINE_WAVE_25_SAMPLES:

0050 7FA0BFD9         49             DB 127, 160, 191, 217, 237, 250, 255, 250, 237, 217, 191, 160, 127, 94, 63, 37, 17,
                              4, 0, 4, 17, 37, 63, 94, 127

0054 EDFAFFFA                
0058 EDD9BFA0                
005C 7F5E3F25                
0060 11040004                
0064 11253F5E                
0068 7F                      
0069                  50     SINE_WAVE_37_SAMPLES:

A51 MACRO ASSEMBLER  PWM_COM_TIMER                                                        04/11/2017 16:50:45 PAGE     2

0069 8096ACC0         51             DB 128, 150, 172, 192, 210, 226, 239, 248, 254, 255, 254, 248, 239, 226, 210, 192, 
                             172, 150, 128, 106, 84, 64, 46, 30, 17, 8, 2, 0, 2, 8, 17, 30, 46, 64, 84, 106, 128

006D D2E2EFF8                
0071 FEFFFEF8                
0075 EFE2D2C0                
0079 AC96806A                
007D 54402E1E                
0081 11080200                
0085 0208111E                
0089 2E40546A                
008D 80                      
008E                  52     SINE_WAVE_71_SAMPLES:

008E 808B96A1         53             DB 128, 139, 150, 161, 172, 182, 192, 201, 210, 218, 226, 233, 239, 245, 248, 253, 
                             254, 255, 254, 253, 248, 245, 239, 233, 226, 218, 210, 201, 192, 182, 172, 161, 150, 139, 1
                             28, 117, 106, 95, 84, 74, 64, 55, 46, 38, 30, 24, 17, 13, 8, 5, 2, 1, 0, 1, 2, 5, 8, 13, 17
                             , 24, 30, 38, 46, 55, 64, 74, 84, 95, 106, 117, 128

0092 ACB6C0C9                
0096 D2DAE2E9                
009A EFF5F8FD                
009E FEFFFEFD                
00A2 F8F5EFE9                
00A6 E2DAD2C9                
00AA C0B6ACA1                
00AE 968B8075                
00B2 6A5F544A                
00B6 40372E26                
00BA 1E18110D                
00BE 08050201                
00C2 00010205                
00C6 080D1118                
00CA 1E262E37                
00CE 404A545F                
00D2 6A7580                  
                      54     

00D5                  55     main:

00D5 753101           56             MOV             WAVE_FORM, #WAVE_FORM_SQUARE  

00D8 E531             57             MOV             A, WAVE_FORM

                      58             

00DA 6004             59             JZ              SINE_WAVE

                      60     

00DC B40238           61             CJNE    A, #02h, SQUARE_WAVE

                      62     

00DF E4               63             CLR             A

                      64     

                      65     

                      66     

                      67     

00E0                  68     SINE_WAVE:

00E0 11F7             69             CALL    PWM_SINE_WAVE_SETUP

                      70             

00E2                  71     PWM_SINE_WAVE_NEXT_PERIOD:

00E2 90008E           72             MOV             DPTR, #SINE_WAVE_71_SAMPLES

00E5 7946             73             MOV             R1, #70d

                      74             

00E7 C287             75             CLR             P0.7

                      76             

00E9                  77     TESTA_R1:

00E9 E9               78             MOV             A, R1

00EA 60F6             79             JZ              PWM_SINE_WAVE_NEXT_PERIOD

                      80             

00EC 80FB             81             JMP     TESTA_R1

                      82     

00EE                  83     PWM_INTERRUPT_SINE_NEXT_SAMPLE:

00EE 93               84             MOVC    A, @A + DPTR

00EF F590             85             MOV             PWM_PORT, A

00F1 E4               86             CLR             A

A51 MACRO ASSEMBLER  PWM_COM_TIMER                                                        04/11/2017 16:50:45 PAGE     3

                      87             

00F2 A3               88             INC     DPTR

00F3 19               89             DEC             R1

                      90             

00F4 3103             91             CALL    PWM_SINE_WAVE_CONFIG_PERIOD

                      92             

00F6 22               93             RET

                      94             

00F7                  95     PWM_SINE_WAVE_SETUP:

00F7 758910           96             MOV     TMOD, #00010000b   

                      97             

00FA 3103             98             CALL    PWM_SINE_WAVE_CONFIG_PERIOD

                      99             

00FC D2AF            100             SETB    EA       

00FE D2AB            101             SETB    ET1  

0100 D28E            102             SETB    TR1  

                     103             

0102 22              104             RET

                     105             

                     106     

                     107     

                     108     

                     109     

                     110     

0103                 111     PWM_SINE_WAVE_CONFIG_PERIOD:

0103 753501          112             MOV             PERIOD_MSB, #001h

0106 7534C8          113             MOV             PERIOD_MED, #0C8h  

0109 753300          114             MOV             PERIOD_LSB, #000h  

                     115             

010C AE34            116             MOV             R6, PERIOD_MED

010E AF35            117             MOV             R7, PERIOD_MSB

                     118             

0110 85348D          119             MOV     TH1,            PERIOD_MED

0113 85338B          120             MOV             TL1,            PERIOD_LSB

                     121             

0116 22              122             RET

                     123     

                     124     

                     125     

                     126     

0117                 127     SQUARE_WAVE:

0117 311B            128             CALL    PWM_SQUARE_WAVE_SETUP

                     129             

0119 80FE            130             JMP     $

                     131             

011B                 132     PWM_SQUARE_WAVE_SETUP:

011B 758910          133             MOV     TMOD, #00010000b   

011E 753223          134             MOV     DUTY_CYCLE, #35d  

                     135             

0121 312A            136             CALL    PWM_SQUARE_WAVE_CONFIG_PERIOD

                     137             

0123 D2AF            138             SETB    EA       

0125 D2AB            139             SETB    ET1  

0127 D28E            140             SETB    TR1  

                     141             

0129 22              142             RET

                     143             

012A                 144     PWM_SQUARE_WAVE_CONFIG_PERIOD:

                     145             

                     146             

                     147             

012A 75350E          148             MOV             PERIOD_MSB, #00Eh

012D 7534FF          149             MOV             PERIOD_MED, #0FFh

0130 7533FF          150             MOV             PERIOD_LSB, #0FFh

                     151             

0133 AE34            152             MOV             R6, PERIOD_MED

A51 MACRO ASSEMBLER  PWM_COM_TIMER                                                        04/11/2017 16:50:45 PAGE     4

0135 AF35            153             MOV             R7, PERIOD_MSB

                     154             

0137 758DFF          155             MOV     TH1, #0FFh

013A 85338B          156             MOV             TL1, PERIOD_LSB

                     157             

013D 22              158             RET

                     159     

013E                 160     PWM_STOP:

013E C28E            161             CLR     TR1                     ; Stop timer to stop PWM

                     162             

0140 22              163             RET

                     164             

0141                 165     PWM_INTERRUPT_SQUARE_WAVE:      

0141 DE27            166             DJNZ    R6, CONTINUE

0143 AE34            167             MOV             R6, PERIOD_MED

                     168             

0145 DF23            169             DJNZ    R7, CONTINUE

0147 AF35            170             MOV             R7, PERIOD_MSB  

                     171     

0149 20000D          172             JB              PWM_FLAG, HIGH_DONE      

                     173                                     

014C                 174     LOW_DONE:                       

014C D200            175             SETB    PWM_FLAG

014E D290            176             SETB    PWM_PIN

                     177             

0150 758DFF          178             MOV             TH1, #0FFh

0153 85328B          179             MOV     TL1, DUTY_CYCLE         

                     180             

0156 C28F            181             CLR     TF1

                     182             

0158 22              183             RET

                     184                                     

0159                 185     HIGH_DONE:

0159 C200            186             CLR     PWM_FLAG                         

015B C290            187             CLR     PWM_PIN                          

                     188             

015D 74FF            189             MOV     A, #0FFh                 

015F C3              190             CLR             C

0160 9532            191             SUBB    A, DUTY_CYCLE

                     192             

0162 758DFF          193             MOV     TH1, #0FFh                       

0165 F58B            194             MOV             TL1, A

                     195             

0167 C28F            196             CLR     TF1                                      

                     197             

0169 22              198             RET

                     199     

016A                 200     CONTINUE:

016A 30000B          201             JNB             PWM_FLAG, CONTINUE_LOW

                     202             

016D                 203     CONTINUE_HIGH:

016D 74FF            204             MOV     A, #0FFh                 

016F C3              205             CLR             C

0170 9532            206             SUBB    A, DUTY_CYCLE

                     207             

0172 758DFF          208             MOV     TH1, #0FFh                       

0175 F58B            209             MOV             TL1, A

                     210     

0177 22              211             RET

                     212                     

0178                 213     CONTINUE_LOW:

0178 758DFF          214             MOV             TH1, #0FFh

017B 85328B          215             MOV     TL1, DUTY_CYCLE

                     216             

017E 22              217             RET

                     218     

A51 MACRO ASSEMBLER  PWM_COM_TIMER                                                        04/11/2017 16:50:45 PAGE     5

                     219     

                     220     

                     221     

                     222     

                     223     

                     224     

                     225     

017F                 226     INT_INT0:

017F 32              227             RETI

                     228     

                     229     

                     230     

                     231     

0180                 232     INT_TIMER0:

0180 32              233             RETI

                     234             

                     235     

                     236     

                     237     

0181                 238     INT_INT1:

0181 32              239             RETI

                     240     

                     241     

                     242     

                     243     

0182                 244     INT_TIMER1:

0182 C0E0            245             PUSH    ACC

                     246     

0184 E531            247             MOV             A, WAVE_FORM

                     248             

0186 6003            249             JZ              JUMP_SINE_INT

                     250     

0188 B40205          251             CJNE    A, #02h, JUMP_SQUARE_INT

                     252     

018B                 253     JUMP_SINE_INT:

018B 11EE            254             CALL    PWM_INTERRUPT_SINE_NEXT_SAMPLE

                     255     

018D D0E0            256             POP             ACC

018F 32              257             RETI

                     258     

0190                 259     JUMP_SQUARE_INT:

0190 3141            260             CALL    PWM_INTERRUPT_SQUARE_WAVE

                     261             

0192 D0E0            262             POP             ACC

0194 32              263             RETI

                     264     

                     265     

                     266     

0195                 267     INT_SERIAL:

0195 32              268             RETI

                     269             

                     270             END

A51 MACRO ASSEMBLER  PWM_COM_TIMER                                                        04/11/2017 16:50:45 PAGE     6

SYMBOL TABLE LISTING
------ ----- -------


N A M E                         T Y P E  V A L U E   ATTRIBUTES

ACC. . . . . . . . . . . . . .  D ADDR   00E0H   A   
CONTINUE . . . . . . . . . . .  C ADDR   016AH   A   
CONTINUE_HIGH. . . . . . . . .  C ADDR   016DH   A   
CONTINUE_LOW . . . . . . . . .  C ADDR   0178H   A   
DUTY_CYCLE . . . . . . . . . .  N NUMB   0032H   A   
EA . . . . . . . . . . . . . .  B ADDR   00A8H.7 A   
ET1. . . . . . . . . . . . . .  B ADDR   00A8H.3 A   
HIGH_DONE. . . . . . . . . . .  C ADDR   0159H   A   
INT_INT0 . . . . . . . . . . .  C ADDR   017FH   A   
INT_INT1 . . . . . . . . . . .  C ADDR   0181H   A   
INT_SERIAL . . . . . . . . . .  C ADDR   0195H   A   
INT_TIMER0 . . . . . . . . . .  C ADDR   0180H   A   
INT_TIMER1 . . . . . . . . . .  C ADDR   0182H   A   
JUMP_SINE_INT. . . . . . . . .  C ADDR   018BH   A   
JUMP_SQUARE_INT. . . . . . . .  C ADDR   0190H   A   
LOW_DONE . . . . . . . . . . .  C ADDR   014CH   A   
MAIN . . . . . . . . . . . . .  C ADDR   00D5H   A   
P0 . . . . . . . . . . . . . .  D ADDR   0080H   A   
P1 . . . . . . . . . . . . . .  D ADDR   0090H   A   
PERIOD_LSB . . . . . . . . . .  N NUMB   0033H   A   
PERIOD_MED . . . . . . . . . .  N NUMB   0034H   A   
PERIOD_MSB . . . . . . . . . .  N NUMB   0035H   A   
PWM_FLAG . . . . . . . . . . .  N NUMB   0000H   A   
PWM_INTERRUPT_SINE_NEXT_SAMPLE  C ADDR   00EEH   A   
PWM_INTERRUPT_SQUARE_WAVE. . .  C ADDR   0141H   A   
PWM_PIN. . . . . . . . . . . .  B ADDR   0090H.0 A   
PWM_PORT . . . . . . . . . . .  D ADDR   0090H   A   
PWM_SINE_WAVE_CONFIG_PERIOD. .  C ADDR   0103H   A   
PWM_SINE_WAVE_NEXT_PERIOD. . .  C ADDR   00E2H   A   
PWM_SINE_WAVE_SETUP. . . . . .  C ADDR   00F7H   A   
PWM_SQUARE_WAVE_CONFIG_PERIOD.  C ADDR   012AH   A   
PWM_SQUARE_WAVE_SETUP. . . . .  C ADDR   011BH   A   
PWM_STOP . . . . . . . . . . .  C ADDR   013EH   A   
SINE_WAVE. . . . . . . . . . .  C ADDR   00E0H   A   
SINE_WAVE_25_SAMPLES . . . . .  C ADDR   0050H   A   
SINE_WAVE_37_SAMPLES . . . . .  C ADDR   0069H   A   
SINE_WAVE_71_SAMPLES . . . . .  C ADDR   008EH   A   
SQUARE_WAVE. . . . . . . . . .  C ADDR   0117H   A   
TESTA_R1 . . . . . . . . . . .  C ADDR   00E9H   A   
TF1. . . . . . . . . . . . . .  B ADDR   0088H.7 A   
TH1. . . . . . . . . . . . . .  D ADDR   008DH   A   
TL1. . . . . . . . . . . . . .  D ADDR   008BH   A   
TMOD . . . . . . . . . . . . .  D ADDR   0089H   A   
TR1. . . . . . . . . . . . . .  B ADDR   0088H.6 A   
WAVE_FORM. . . . . . . . . . .  N NUMB   0031H   A   
WAVE_FORM_SINE . . . . . . . .  N NUMB   0000H   A   
WAVE_FORM_SQUARE . . . . . . .  N NUMB   0001H   A   


REGISTER BANK(S) USED: 0 


ASSEMBLY COMPLETE.  0 WARNING(S), 0 ERROR(S)
