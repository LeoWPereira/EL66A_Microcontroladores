A51 MACRO ASSEMBLER  PROJETO_03_RFID                                                      05/19/2017 14:59:02 PAGE     1


MACRO ASSEMBLER A51 V8.2.5.0
OBJECT MODULE PLACED IN .\Objects\Projeto_03_RFID.obj
ASSEMBLER INVOKED BY: C:\Keil_v5\C51\BIN\A51.EXE Projeto_03_RFID.a51 SET(SMALL) DEBUG PRINT(.\Listings\Projeto_03_RFID.l
                      st) OBJECT(.\Objects\Projeto_03_RFID.obj) EP

LOC  OBJ            LINE     SOURCE

                       1     

                       2     

                       3     

                       4     

                       5     

                       6     

                       7     

                       8     

                       9     

                      10     

                      11     

                      12     

                      13     $nomod51 

                      14     ;#include <at89c5131.h>

                +1    15     

                +1    16     

                +1    17     

                +1    18     

                +1    19     

                +1    20     

                +1    21     

                +1    22     

                +1    23     

                +1    24     

                +1    25     

                +1    26     

                +1    27     

                +1    28     

                +1    29     

                +1    30     

                +1    31     

                +1    32     

                +1    33     

                +1    34     

                +1    35     

                +1    36     

                +1    37     

                +1    38     

                +1    39     

                +1    40     

                +1    41     

                +1    42     

                +1    43     

  00E0          +1    44     sfr ACC = 0xE0 ;        /* Sfr ( ACC, bit addressable)*/

  00F0          +1    45     sfr B = 0xF0 ;        /* Sfr ( B,   bit addressable)*/

  00D0          +1    46     sfr PSW = 0xD0 ;        /* Sfr ( PSW, bit addressable)*/

  0081          +1    47     sfr SP = 0x81 ;

  0082          +1    48     sfr DPL = 0x82 ;

  0083          +1    49     sfr DPH = 0x83 ;

                +1    50     

                +1    51     

                +1    52     

                +1    53     

                +1    54     

                +1    55     

  0080          +1    56     sfr P0 = 0x80 ;        /* Sfr ( P0, bit addressable)*/

                +1    57     

A51 MACRO ASSEMBLER  PROJETO_03_RFID                                                      05/19/2017 14:59:02 PAGE     2

  0087          +1    58     sbit P0_7 = P0 ^ 7 ;

  0086          +1    59     sbit P0_6 = P0 ^ 6 ;

  0085          +1    60     sbit P0_5 = P0 ^ 5 ;

  0084          +1    61     sbit P0_4 = P0 ^ 4 ;

  0083          +1    62     sbit P0_3 = P0 ^ 3 ;

  0082          +1    63     sbit P0_2 = P0 ^ 2 ;

  0081          +1    64     sbit P0_1 = P0 ^ 1 ;

  0080          +1    65     sbit P0_0 = P0 ^ 0 ;

                +1    66     

  0090          +1    67     sfr P1 = 0x90 ;        /* Sfr ( P1, bit addressable)*/

                +1    68     

  0097          +1    69     sbit P1_7 = P1 ^ 7 ;

  0096          +1    70     sbit P1_6 = P1 ^ 6 ;

  0095          +1    71     sbit P1_5 = P1 ^ 5 ;

  0094          +1    72     sbit P1_4 = P1 ^ 4 ;

  0093          +1    73     sbit P1_3 = P1 ^ 3 ;

  0092          +1    74     sbit P1_2 = P1 ^ 2 ;

  0091          +1    75     sbit P1_1 = P1 ^ 1 ;

  0090          +1    76     sbit P1_0 = P1 ^ 0 ;

                +1    77     

  00A0          +1    78     sfr P2 = 0xA0 ;        /* Sfr ( P2, bit addressable)*/

                +1    79     

  00A7          +1    80     sbit P2_7 = P2 ^ 7 ;

  00A6          +1    81     sbit P2_6 = P2 ^ 6 ;

  00A5          +1    82     sbit P2_5 = P2 ^ 5 ;

  00A4          +1    83     sbit P2_4 = P2 ^ 4 ;

  00A3          +1    84     sbit P2_3 = P2 ^ 3 ;

  00A2          +1    85     sbit P2_2 = P2 ^ 2 ;

  00A1          +1    86     sbit P2_1 = P2 ^ 1 ;

  00A0          +1    87     sbit P2_0 = P2 ^ 0 ;

                +1    88     

  00B0          +1    89     sfr P3 = 0xB0 ;        /* Sfr ( P3, bit addressable)*/

                +1    90     

  00B7          +1    91     sbit P3_7 = P3 ^ 7 ;

  00B6          +1    92     sbit P3_6 = P3 ^ 6 ;

  00B5          +1    93     sbit P3_5 = P3 ^ 5 ;

  00B4          +1    94     sbit P3_4 = P3 ^ 4 ;

  00B3          +1    95     sbit P3_3 = P3 ^ 3 ;

  00B2          +1    96     sbit P3_2 = P3 ^ 2 ;

  00B1          +1    97     sbit P3_1 = P3 ^ 1 ;

  00B0          +1    98     sbit P3_0 = P3 ^ 0 ;

                +1    99     

  00C0          +1   100     sfr P4 = 0xC0 ;        /* Sfr ( P4, bit addressable)*/

                +1   101     

  00C1          +1   102     sbit P4_1 = P4 ^ 1 ;

  00C0          +1   103     sbit P4_0 = P4 ^ 0 ;

                +1   104     

                +1   105     

                +1   106     

                +1   107     

  008C          +1   108     sfr TH0 = 0x8C ; 

  008A          +1   109     sfr TL0 = 0x8A ;

  008D          +1   110     sfr TH1 = 0x8D ;

  008B          +1   111     sfr TL1 = 0x8B ;

  00CD          +1   112     sfr TH2 = 0xCD ;

  00CC          +1   113     sfr TL2 = 0xCC ;

  0088          +1   114     sfr TCON = 0x88 ;        /* Sfr ( TCON,  bit addressable)*/

  0089          +1   115     sfr TMOD = 0x89 ;

  00C8          +1   116     sfr T2CON = 0xC8 ;        /* Sfr ( T2CON, bit addressable)*/

  00C9          +1   117     sfr T2MOD = 0xC9 ;

  00CB          +1   118     sfr RCAP2H = 0xCB ;

  00CA          +1   119     sfr RCAP2L = 0xCA ;

  00A6          +1   120     sfr WDTRST = 0xA6 ;

  00A7          +1   121     sfr WDTPRG = 0xA7 ;

                +1   122     

                +1   123                                 

A51 MACRO ASSEMBLER  PROJETO_03_RFID                                                      05/19/2017 14:59:02 PAGE     3

  008F          +1   124     sbit TF1 = TCON ^ 7 ;

  008E          +1   125     sbit TR1 = TCON ^ 6 ;

  008D          +1   126     sbit TF0 = TCON ^ 5 ;

  008C          +1   127     sbit TR0 = TCON ^ 4 ;

  008B          +1   128     sbit IE1_ = TCON ^ 3 ;

  008A          +1   129     sbit IT1 = TCON ^ 2 ;

  0089          +1   130     sbit IE0_ = TCON ^ 1 ;

  0088          +1   131     sbit IT0 = TCON ^ 0 ;

                +1   132                                 

  00CF          +1   133     sbit TF2 = T2CON ^ 7 ;

  00CE          +1   134     sbit EXF2 = T2CON ^ 6 ;

  00CD          +1   135     sbit RCLK = T2CON ^ 5 ;

  00CC          +1   136     sbit TCLK = T2CON ^ 4 ;

  00CB          +1   137     sbit EXEN2 = T2CON ^ 3 ;

  00CA          +1   138     sbit TR2 = T2CON ^ 2 ;

  00C9          +1   139     sbit C_T2 = T2CON ^ 1 ;

  00C8          +1   140     sbit CP_RL2 = T2CON ^ 0 ;

                +1   141     

                +1   142     

                +1   143     

                +1   144     

  0098          +1   145     sfr SCON = 0x98 ;

  0099          +1   146     sfr SBUF = 0x99 ;

  00B9          +1   147     sfr SADEN = 0xB9 ;

  00A9          +1   148     sfr SADDR = 0xA9 ;

                +1   149     

  009F          +1   150     sbit FE_SM0 = SCON ^ 7 ;

  009E          +1   151     sbit SM1 = SCON ^ 6 ;

  009D          +1   152     sbit SM2 = SCON ^ 5 ;

  009C          +1   153     sbit REN = SCON ^ 4 ;

  009B          +1   154     sbit TB8 = SCON ^ 3 ;

  009A          +1   155     sbit RB8 = SCON ^ 2 ;

  0099          +1   156     sbit TI = SCON ^ 1 ;

  0098          +1   157     sbit RI = SCON ^ 0 ;

                +1   158     

                +1   159     

                +1   160     

  009A          +1   161     sfr BRL = 0x9A ;

  009B          +1   162     sfr BDRCON = 0x9B ;

                +1   163     

                +1   164     

                +1   165     

  00D8          +1   166     sfr CCON = 0xD8 ;      /* Sfr ( CCON, bit addressable)*/

  00D9          +1   167     sfr CMOD = 0xD9 ;

  00E9          +1   168     sfr CL = 0xE9 ;

  00F9          +1   169     sfr CH = 0xF9 ;

  00DA          +1   170     sfr CCAPM0 = 0xDA ;

  00DB          +1   171     sfr CCAPM1 = 0xDB ;

  00DC          +1   172     sfr CCAPM2 = 0xDC ;

  00DD          +1   173     sfr CCAPM3 = 0xDD ;

  00DE          +1   174     sfr CCAPM4 = 0xDE ;

  00FA          +1   175     sfr CCAP0H = 0xFA ;

  00FB          +1   176     sfr CCAP1H = 0xFB ;

  00FC          +1   177     sfr CCAP2H = 0xFC ;

  00FD          +1   178     sfr CCAP3H = 0xFD ;

  00FE          +1   179     sfr CCAP4H = 0xFE ;

  00EA          +1   180     sfr CCAP0L = 0xEA ;

  00EB          +1   181     sfr CCAP1L = 0xEB ;

  00EC          +1   182     sfr CCAP2L = 0xEC ;

  00ED          +1   183     sfr CCAP3L = 0xED ;

  00EE          +1   184     sfr CCAP4L = 0xEE ;

                +1   185     

                +1   186                                  

  00DF          +1   187     sbit CF = CCON ^ 7 ;

  00DE          +1   188     sbit CR = CCON ^ 6 ;

  00DC          +1   189     sbit CCF4 = CCON ^ 4 ;

A51 MACRO ASSEMBLER  PROJETO_03_RFID                                                      05/19/2017 14:59:02 PAGE     4

  00DB          +1   190     sbit CCF3 = CCON ^ 3 ;

  00DA          +1   191     sbit CCF2 = CCON ^ 2 ;

  00D9          +1   192     sbit CCF1 = CCON ^ 1 ;

  00D8          +1   193     sbit CCF0 = CCON ^ 0 ;

                +1   194     

                +1   195     

                +1   196     

                +1   197     

  00A8          +1   198     sfr IEN0 = 0xA8 ;       /* Sfr ( IEN0,  bit addressable                 */

  00B1          +1   199     sfr IEN1 = 0xB1 ;

  00B8          +1   200     sfr IPL0 = 0xB8 ;       /* Sfr ( IPL0, bit addressable          */

  00B7          +1   201     sfr IPH0 = 0xB7 ;

  00B2          +1   202     sfr IPL1 = 0xB2 ;

  00B3          +1   203     sfr IPH1 = 0xB3 ;

                +1   204     

                +1   205                                  

  00AF          +1   206     sbit EA = IEN0 ^ 7 ;

  00AE          +1   207     sbit EC = IEN0 ^ 6 ;

  00AD          +1   208     sbit ET2 = IEN0 ^ 5 ;

  00AC          +1   209     sbit ES = IEN0 ^ 4 ;

  00AB          +1   210     sbit ET1 = IEN0 ^ 3 ;

  00AA          +1   211     sbit EX1 = IEN0 ^ 2 ;

  00A9          +1   212     sbit ET0 = IEN0 ^ 1 ;

  00A8          +1   213     sbit EX0 = IEN0 ^ 0 ;

                +1   214                                  

  00BE          +1   215     sbit PPCL = IPL0 ^ 6 ;

  00BD          +1   216     sbit PT2L = IPL0 ^ 5 ;

  00BC          +1   217     sbit PSL = IPL0 ^ 4 ;

  00BB          +1   218     sbit PTIL = IPL0 ^ 3 ;

  00BA          +1   219     sbit PXIL = IPL0 ^ 2 ;

  00B9          +1   220     sbit PT0L = IPL0 ^ 1 ;

  00B8          +1   221     sbit PX0L = IPL0 ^ 0 ;

                +1   222     

                +1   223     

                +1   224     

  00A3          +1   225     sfr PLLCON = 0xA3 ;

  00A4          +1   226     sfr PLLDIV = 0xA4 ;

                +1   227     

                +1   228     

                +1   229     

  009E          +1   230     sfr KBF = 0x9E ;

  009D          +1   231     sfr KBE = 0x9D ;

  009C          +1   232     sfr KBLS = 0x9C ;

                +1   233     

                +1   234     

                +1   235     

  0093          +1   236     sfr SSCON = 0x93 ;

  0094          +1   237     sfr SSCS = 0x94 ;

  0095          +1   238     sfr SSDAT = 0x95 ;

  0096          +1   239     sfr SSADR = 0x96 ;

                +1   240     

                +1   241     

                +1   242     

  00C3          +1   243     sfr SPCON = 0xC3 ;

  00C4          +1   244     sfr SPSTA = 0xC4 ;

  00C5          +1   245     sfr SPDAT = 0xC5 ;

                +1   246     

                +1   247     

                +1   248     

  00BC          +1   249     sfr USBCON = 0xBC ;

  00C6          +1   250     sfr USBADDR = 0xC6 ;

  00BD          +1   251     sfr USBINT = 0xBD ;

  00BE          +1   252     sfr USBIEN = 0xBE ;

  00C7          +1   253     sfr UEPNUM = 0xC7 ;

  00D4          +1   254     sfr UEPCONX = 0xD4 ;

  00CE          +1   255     sfr UEPSTAX = 0xCE ;

A51 MACRO ASSEMBLER  PROJETO_03_RFID                                                      05/19/2017 14:59:02 PAGE     5

  00D5          +1   256     sfr UEPRST = 0xD5 ;

  00F8          +1   257     sfr UEPINT = 0xF8 ;         /* Sfr ( UEPINT, bit addressable) */

  00C2          +1   258     sfr UEPIEN = 0xC2 ;

  00CF          +1   259     sfr UEPDATX = 0xCF ;

  00E2          +1   260     sfr UBYCTLX = 0xE2 ;

  00E3          +1   261     sfr UBYCTHX = 0xE3 ;

  00D6          +1   262     sfr UDPADDL = 0xD6 ;

  00D7          +1   263     sfr UDPADDH = 0xD7 ;

  00BA          +1   264     sfr UFNUML = 0xBA ;

  00BB          +1   265     sfr UFNUMH = 0xBB ;

                +1   266                                     

  00FE          +1   267     sbit EP6INT = UEPINT ^ 6 ;

  00FD          +1   268     sbit EP5INT = UEPINT ^ 5 ;

  00FC          +1   269     sbit EP4INT = UEPINT ^ 4 ;

  00FB          +1   270     sbit EP3INT = UEPINT ^ 3 ;

  00FA          +1   271     sbit EP2INT = UEPINT ^ 2 ;

  00F9          +1   272     sbit EP1INT = UEPINT ^ 1 ;

  00F8          +1   273     sbit EP0INT = UEPINT ^ 0 ;

                +1   274     

                +1   275     

                +1   276     

  0087          +1   277     sfr PCON = 0x87 ;

  008E          +1   278     sfr AUXR = 0x8E ;

  00A2          +1   279     sfr AUXR1 = 0xA2 ;

  008F          +1   280     sfr CKCON0 = 0x8F ;

  00AF          +1   281     sfr CKCON1 = 0xAF ;

  0085          +1   282     sfr CKSEL = 0x85 ;

  00F1          +1   283     sfr LEDCON = 0xF1 ;

  00D1          +1   284     sfr FCON = 0xD1 ;

  00D2          +1   285     sfr EECON = 0xD2 ;

                +1   286     

                +1   287     

                +1   288     

                +1   289     

                     290     

                     291     ;#include "lcd16x2.a51"

                +1   292     

                +1   293     

                +1   294     

                +1   295     

                +1   296     

                +1   297     

                +1   298     

                +1   299     

                +1   300     

                +1   301     

                +1   302     

                +1   303     

0F00            +1   304     ORG             0F00h

                +1   305     

                +1   306     

                +1   307     

                +1   308     

                +1   309     

                +1   310     

  0080          +1   311     DISPLAY EQU P0

  0087          +1   312     BUSYF   EQU     P0.7                     

                +1   313     

  00A5          +1   314     RS              EQU     P2.5                     

  00A7          +1   315     E_LCD   EQU     P2.7                     

  00A6          +1   316     RW              EQU     P2.6                     

                +1   317     

                +1   318     

                +1   319     

                +1   320     

                +1   321     

A51 MACRO ASSEMBLER  PROJETO_03_RFID                                                      05/19/2017 14:59:02 PAGE     6

                +1   322     

                +1   323     

                +1   324     

                +1   325     

                +1   326     

0F00            +1   327     INIDISP:

0F00 7838       +1   328             MOV     R0,#38h           

0F02 7A05       +1   329             MOV     R2,#05h           

0F04 F11F       +1   330             CALL    ESCINST           

                +1   331             

0F06 7838       +1   332                     MOV     R0,#38h           

0F08 7A01       +1   333             MOV     R2,#01h           

0F0A F11F       +1   334             CALL    ESCINST           

                +1   335             

0F0C 7806       +1   336                     MOV     R0,#06h           

0F0E 7A01       +1   337             MOV     R2,#01h           

0F10 F11F       +1   338             CALL    ESCINST           

                +1   339             

0F12 780C       +1   340                     MOV     R0,#0Ch           

0F14 7A01       +1   341             MOV     R2,#01h           

0F16 F11F       +1   342             CALL    ESCINST           

                +1   343             

0F18 7801       +1   344                     MOV     R0,#01h           

0F1A 7A02       +1   345             MOV     R2,#02h           

0F1C F11F       +1   346             CALL    ESCINST           

                +1   347             

0F1E 22         +1   348                     RET

                +1   349                     

                +1   350     

                +1   351     

                +1   352     

                +1   353     

                +1   354     

                +1   355     

                +1   356     

                +1   357     

                +1   358     

0F1F            +1   359     ESCINST:  

0F1F C2A6       +1   360                     CLR             RW                               

0F21 C2A5       +1   361                     CLR     RS               

0F23 D2A7       +1   362                     SETB    E_LCD            

                +1   363                     

0F25 8880       +1   364                     MOV     DISPLAY, R0      

                +1   365                     

0F27 C2A7       +1   366                     CLR     E_LCD            

                +1   367                     

0F29 7580FF     +1   368                     MOV             DISPLAY,#0xFF    

                +1   369                     

0F2C D2A6       +1   370                     SETB    RW                               

0F2E D2A7       +1   371                     SETB    E_LCD            

                +1   372     

0F30 2087FD     +1   373                     JB              BUSYF, $                 

                +1   374                     

0F33 C2A7       +1   375                     CLR     E_LCD            

                +1   376             

0F35 22         +1   377                     RET

                +1   378                     

                +1   379     

                +1   380     

                +1   381     

                +1   382     

                +1   383     

                +1   384     

                +1   385     

                +1   386     

0F36            +1   387     GOTOXY: 

A51 MACRO ASSEMBLER  PROJETO_03_RFID                                                      05/19/2017 14:59:02 PAGE     7

0F36 C0E0       +1   388                     PUSH    ACC

                +1   389             

0F38 7480       +1   390                     MOV     A, #80h

0F3A B80102     +1   391             CJNE    R0, #01h, GT1       

                +1   392             

0F3D 74C0       +1   393                     MOV     A, #0C0h

                +1   394                     

0F3F 49         +1   395     GT1:    ORL     A, R1              

0F40 F8         +1   396             MOV     R0, A

0F41 7A01       +1   397             MOV     R2, #01h           

                +1   398             

0F43 F11F       +1   399                     CALL    ESCINST            

                +1   400             

0F45 D0E0       +1   401                     POP     ACC

                +1   402             

0F47 22         +1   403                     RET

                +1   404             

                +1   405     

                +1   406     

                +1   407     

                +1   408     

                +1   409     

                +1   410     

                +1   411     

                +1   412     

0F48            +1   413     CLR1L:    

0F48 C0E0       +1   414             PUSH   ACC

                +1   415             

0F4A 7800       +1   416                     MOV    R0, #00h               

0F4C 7900       +1   417             MOV    R1, #00h

                +1   418             

0F4E F136       +1   419                     CALL   GOTOXY

                +1   420             

0F50 7910       +1   421                     MOV    R1, #16              

                +1   422     

0F52 7420       +1   423     CLR1L1: MOV    A,#' '               

                +1   424             

0F54 F17A       +1   425                     CALL   ESCDADO

                +1   426             

0F56 D9FA       +1   427                     DJNZ   R1, CLR1L1

0F58 7800       +1   428             MOV    R0, #00               

0F5A 7900       +1   429             MOV    R1, #00

                +1   430             

0F5C F136       +1   431                     CALL   GOTOXY

                +1   432             

0F5E D0E0       +1   433                     POP    ACC

                +1   434             

0F60 22         +1   435                     RET

                +1   436                     

                +1   437     

                +1   438     

                +1   439     

                +1   440     

                +1   441     

                +1   442     

                +1   443     

                +1   444     

0F61            +1   445     CLR2L:    

0F61 C0E0       +1   446             PUSH   ACC

                +1   447             

0F63 7801       +1   448                     MOV    R0,#01               

0F65 7900       +1   449             MOV    R1,#00

                +1   450             

0F67 F136       +1   451                     CALL   GOTOXY

                +1   452             

0F69 7910       +1   453                     MOV    R1,#16               

A51 MACRO ASSEMBLER  PROJETO_03_RFID                                                      05/19/2017 14:59:02 PAGE     8

                +1   454     

0F6B 7420       +1   455     CLR2L1: MOV    A,#' '               

                +1   456             

0F6D F17A       +1   457                     CALL   ESCDADO

                +1   458             

0F6F D9FA       +1   459                     DJNZ   R1,CLR2L1

0F71 7801       +1   460             MOV    R0,#01               

0F73 7900       +1   461             MOV    R1,#00

                +1   462             

0F75 F136       +1   463                     CALL   GOTOXY

                +1   464             

0F77 D0E0       +1   465                     POP    ACC

                +1   466             

0F79 22         +1   467                     RET

                +1   468                

                +1   469     

                +1   470     

                +1   471     

                +1   472     

                +1   473     

                +1   474     

                +1   475     

0F7A            +1   476     ESCDADO:  

0F7A C2A6       +1   477                     CLR             RW                               

0F7C D2A5       +1   478             SETB    RS               

0F7E D2A7       +1   479             SETB    E_LCD            

                +1   480                     

0F80 F580       +1   481             MOV     DISPLAY, A       

                +1   482             

0F82 C2A7       +1   483                     CLR     E_LCD            

                +1   484                     

0F84 7580FF     +1   485                     MOV             DISPLAY,#0xFF    

                +1   486                     

0F87 D2A6       +1   487                     SETB    RW                               

0F89 C2A5       +1   488                     CLR             RS                               

0F8B D2A7       +1   489                     SETB    E_LCD            

                +1   490     

0F8D 2087FD     +1   491                     JB              BUSYF, $                 

                +1   492     

0F90 C2A7       +1   493                     CLR     E_LCD            

                +1   494     

0F92 22         +1   495             RET

                +1   496                     

                +1   497     

                +1   498     

                +1   499     

                +1   500     

                +1   501     

                +1   502     

                +1   503     

                +1   504     

                +1   505     

0F93            +1   506     MSTRING:  

0F93 E4         +1   507                     CLR     A

                +1   508                       

0F94 93         +1   509             MOVC    A, @A+DPTR       

                +1   510               

0F95 6006       +1   511                     JZ      MSTR1

                +1   512               

0F97 120F7A     +1   513                     LCALL   ESCDADO         

                +1   514               

0F9A A3         +1   515                     INC     DPTR

                +1   516               

0F9B 80F6       +1   517                     SJMP    MSTRING

                +1   518                       

0F9D            +1   519     MSTR1:  

A51 MACRO ASSEMBLER  PROJETO_03_RFID                                                      05/19/2017 14:59:02 PAGE     9

0F9D 22         +1   520                     RET

                +1   521                

                +1   522     

                +1   523     

                +1   524     

                +1   525     

                +1   526     

                +1   527     

                +1   528     

                +1   529     

                +1   530     

0F9E            +1   531     MSTRINGX: 

0F9E E0         +1   532                     MOVX    A, @DPTR         

                +1   533               

0F9F 6006       +1   534                     JZ      MSTR21

                +1   535               

0FA1 120F7A     +1   536                     LCALL   ESCDADO         

                +1   537               

0FA4 A3         +1   538                     INC     DPTR

                +1   539               

0FA5 80F7       +1   540                     SJMP    MSTRINGX

                +1   541     

0FA7            +1   542     MSTR21:   

0FA7 22         +1   543                     RET

                +1   544     

                +1   545     

                +1   546     

                +1   547     

                +1   548     

                +1   549     

                +1   550     

                +1   551     

                +1   552     

                +1   553     

0FA8            +1   554     ESC_STR1: 

                +1   555                       

0FA8 7800       +1   556                       MOV    R0, #00         

0FAA 7900       +1   557               MOV    R1, #00

0FAC 8004       +1   558                       JMP    ESC_S

                +1   559               

                +1   560     

                +1   561     

                +1   562     

                +1   563     

                +1   564     

                +1   565     

                +1   566     

                +1   567     

                +1   568     

0FAE            +1   569     ESC_STR2: 

                +1   570                       

0FAE 7801       +1   571                       MOV    R0,#01         

0FB0 7900       +1   572               MOV    R1,#00

                +1   573                       

0FB2 120F36     +1   574     ESC_S:    LCALL  GOTOXY          

                +1   575               

0FB5 120F93     +1   576                       LCALL  MSTRING

                +1   577               

0FB8 22         +1   578                       RET

                +1   579     

                +1   580     

                +1   581     

                +1   582     

                +1   583     

                +1   584     

                +1   585     

A51 MACRO ASSEMBLER  PROJETO_03_RFID                                                      05/19/2017 14:59:02 PAGE    10

                +1   586     ; DESTROI: R0,R2                                                                        //

                +1   587     

0FB9            +1   588     CUR_ON:   

0FB9 780F       +1   589                       MOV    R0,#0Fh               

0FBB 8002       +1   590               SJMP   CUR1

                +1   591                       

0FBD            +1   592     CUR_OFF:  

0FBD 780C       +1   593                       MOV    R0,#0Ch               

                +1   594                       

0FBF 7A01       +1   595     CUR1:     MOV    R2,#01

                +1   596               

0FC1 F11F       +1   597                       CALL   ESCINST               

                +1   598               

0FC3 22         +1   599                       RET

                +1   600                       

                +1   601     

                +1   602     

                +1   603     

                +1   604     

                +1   605     

                +1   606     

                +1   607     

0FC4            +1   608     ESCREVE_ASTERISCO:

0FC4 C0E0       +1   609                     PUSH    ACC

                +1   610                     

0FC6 742A       +1   611                     MOV     A, #2Ah  

0FC8 F17A       +1   612                     CALL    ESCDADO

                +1   613             

0FCA D0E0       +1   614                     POP             ACC

                +1   615             

0FCC 22         +1   616                     RET

                     617     

                     618     ;#include "timer.a51"

                +1   619     

                +1   620     

                +1   621     

                +1   622     

                +1   623     

                +1   624     

                +1   625     

                +1   626     

                +1   627     

0D00            +1   628     ORG             0D00h

                +1   629     

                +1   630     

                +1   631     

                +1   632     

                +1   633     

                +1   634     

                +1   635     

                +1   636     

                +1   637     

                +1   638     

                +1   639     

                +1   640     

                +1   641     

                +1   642     

                +1   643     

                +1   644     

0D00            +1   645     TIMER_CONFIGURA_TIMER_SEM_INT:

0D00 8F89       +1   646                     MOV     TMOD, R7  

                +1   647                     

0D02 B105       +1   648                     ACALL   SETA_VALORES_TIMER_SEM_INT

                +1   649                     

0D04 22         +1   650                     RET

                +1   651                     

A51 MACRO ASSEMBLER  PROJETO_03_RFID                                                      05/19/2017 14:59:02 PAGE    11

                +1   652     

                +1   653     

                +1   654     

                +1   655     

                +1   656     

                +1   657     

                +1   658     

                +1   659     

                +1   660     

                +1   661     

0D05            +1   662     SETA_VALORES_TIMER_SEM_INT:

0D05 8E8D       +1   663                     MOV     TH1, R6

0D07 8D8B       +1   664                     MOV     TL1, R5

0D09 8C8C       +1   665                     MOV     TH0, R4

0D0B 8B8A       +1   666                     MOV     TL0, R3

                +1   667                     

0D0D 22         +1   668                     RET

                +1   669     

                +1   670     

                +1   671     

                +1   672     

                +1   673     

                +1   674     

                +1   675     

                +1   676     

0D0E            +1   677     TIMER_DELAY_10_US: 

0D0E 7E02       +1   678                     MOV     R6, #02d     

0D10 DEFE       +1   679                     DJNZ    R6, $

                +1   680                     

0D12 22         +1   681                     RET

                +1   682                     

                +1   683     

                +1   684     

                +1   685     

                +1   686     

                +1   687     

                +1   688     

                +1   689     

                +1   690     

                +1   691     

                +1   692     

0D13            +1   693     TIMER_DELAY_1_MS:

                +1   694                     

0D13 7F01       +1   695                     MOV             R7, #00000001b

0D15 7E00       +1   696                     MOV             R6, #00h

0D17 7D00       +1   697                     MOV             R5, #00h

0D19 7CF8       +1   698                     MOV     R4, #HIGH(65535 - 1984)

0D1B 7B3F       +1   699                     MOV     R3, #LOW(65535 - 1984)

0D1D B100       +1   700                     ACALL   TIMER_CONFIGURA_TIMER_SEM_INT

                +1   701     

0D1F            +1   702     CONTINUA_TIMER_1_MS:

0D1F C28D       +1   703                     CLR     TF0

0D21 D28C       +1   704                     SETB    TR0

                +1   705             

0D23 308DFD     +1   706                     JNB     TF0, $

                +1   707                             

0D26 B105       +1   708                     ACALL   SETA_VALORES_TIMER_SEM_INT

                +1   709                     

0D28 C28D       +1   710                     CLR     TF0

0D2A C28C       +1   711                     CLR     TR0

                +1   712             

0D2C D8F1       +1   713                     DJNZ    R0, CONTINUA_TIMER_1_MS

                +1   714             

0D2E 22         +1   715                     RET

                +1   716     

                +1   717     

A51 MACRO ASSEMBLER  PROJETO_03_RFID                                                      05/19/2017 14:59:02 PAGE    12

                +1   718     

                +1   719     

                +1   720     

                +1   721     

                +1   722     

                +1   723     

0D2F            +1   724     TIMER_DELAY_200_MS:

0D2F 78C8       +1   725                     MOV             R0, #0C8h 

                +1   726     

0D31 B113       +1   727                     ACALL   TIMER_DELAY_1_MS

                +1   728                     

0D33 D9FA       +1   729                     DJNZ    R1, TIMER_DELAY_200_MS

                +1   730             

0D35 22         +1   731                     RET

                +1   732             

                +1   733     

                +1   734     

                +1   735     

                +1   736     

                +1   737     

                +1   738     

                +1   739     

0D36            +1   740     TIMER_DELAY_1_S:

0D36 7905       +1   741                     MOV             R1, #05h

0D38 B12F       +1   742                     ACALL   TIMER_DELAY_200_MS

                +1   743                     

0D3A DAFA       +1   744                     DJNZ    R2, TIMER_DELAY_1_S

                +1   745             

0D3C 22         +1   746                     RET

                +1   747                     

                +1   748     

                +1   749     

                +1   750     

                +1   751     

                +1   752     

                +1   753     

                +1   754     

                +1   755     

                +1   756     

                +1   757     

                +1   758     

                +1   759     

0D3D            +1   760     TIMER_DELAY:

0D3D C0E0       +1   761                     PUSH    ACC

0D3F C0F0       +1   762                     PUSH    B

                +1   763     

0D41 BA0013     +1   764                     CJNE    R2, #00h, CHAMA_TIMER_1_S

                +1   765     

0D44            +1   766     VERIFICA_R1:

0D44 B90009     +1   767                     CJNE    R1, #00h, CHAMA_TIMER_200_MS

                +1   768                     

0D47            +1   769     VERIFICA_R0:

0D47 B80002     +1   770                     CJNE    R0, #00h, CHAMA_TIMER_1_MS

                +1   771                     

0D4A A161       +1   772                     AJMP    FINALIZA_TIMER_DELAY

                +1   773                     

0D4C            +1   774     CHAMA_TIMER_1_MS:

0D4C B113       +1   775                     ACALL   TIMER_DELAY_1_MS

0D4E A161       +1   776                     AJMP    FINALIZA_TIMER_DELAY

                +1   777     

0D50            +1   778     CHAMA_TIMER_200_MS:

0D50 EE         +1   779                     MOV             A, R6

0D51 E8         +1   780                     MOV             A, R0

                +1   781                     

0D52 B12F       +1   782                     ACALL   TIMER_DELAY_200_MS

                +1   783                     

A51 MACRO ASSEMBLER  PROJETO_03_RFID                                                      05/19/2017 14:59:02 PAGE    13

0D54 F8         +1   784                     MOV             R0, A

                +1   785                     

0D55 A147       +1   786                     AJMP    VERIFICA_R0

                +1   787                     

0D57            +1   788     CHAMA_TIMER_1_S:

0D57 E8         +1   789                     MOV             A, R0

0D58 89F0       +1   790                     MOV             B, R1

                +1   791     

0D5A B136       +1   792                     ACALL   TIMER_DELAY_1_S

                +1   793                     

0D5C F8         +1   794                     MOV             R0, A

0D5D A9F0       +1   795                     MOV             R1, B

                +1   796                     

0D5F A144       +1   797                     AJMP    VERIFICA_R1

                +1   798     

0D61            +1   799     FINALIZA_TIMER_DELAY:

0D61 D0F0       +1   800                     POP             B

0D63 D0E0       +1   801                     POP     ACC

                +1   802                     

0D65 22         +1   803                     RET

                     804     

                     805     ;#include "serial.a51"

                +1   806     

                +1   807     

                +1   808     

                +1   809     

                +1   810     

                +1   811     

                +1   812     

                +1   813     

                +1   814             

0A00            +1   815     ORG             0A00h

                +1   816             

                +1   817     

                +1   818     

                +1   819     

                +1   820     

                +1   821     

                +1   822     

                +1   823     

                +1   824     

                +1   825     

                +1   826     

                +1   827     

0A00            +1   828     CONFIGURA_SERIAL:

0A00 8998       +1   829                     MOV     SCON, R1

0A02 8887       +1   830                     MOV     PCON, R0

                +1   831                     

0A04 C298       +1   832                     CLR             RI

0A06 C299       +1   833                     CLR             TI

                +1   834     

0A08 22         +1   835                     RET

                +1   836             

                +1   837     

                +1   838     

                +1   839     

                +1   840     

                +1   841     

                +1   842     

                +1   843     

                +1   844     

                +1   845     

                +1   846     

0A09            +1   847     CONFIGURA_BAUD_RATE:

0A09 8989       +1   848                     MOV     TMOD, R1

0A0B 888D       +1   849                     MOV     TH1,  R0 

A51 MACRO ASSEMBLER  PROJETO_03_RFID                                                      05/19/2017 14:59:02 PAGE    14

                +1   850                     

0A0D D28E       +1   851                     SETB    TR1

                +1   852     

0A0F 22         +1   853                     RET

                +1   854                     

                +1   855     

                +1   856     

                +1   857     

                +1   858     

                +1   859     

                +1   860     

                +1   861     

0A10            +1   862     RECEBE_DADO:

0A10 3098FD     +1   863                     JNB             RI, $

                +1   864                     

0A13 C298       +1   865                     CLR             RI

                +1   866                     

0A15 E599       +1   867                     MOV             A,  SBUF

                +1   868     

0A17 22         +1   869                     RET

                +1   870     

                +1   871     

                +1   872     

                +1   873     

                +1   874     

                +1   875     

                +1   876     

                +1   877     

0A18            +1   878     ENVIA_DADO:

0A18 F599       +1   879                     MOV             SBUF, A

                +1   880                     

0A1A 3099FD     +1   881                     JNB             TI,   $

                +1   882                     

0A1D C299       +1   883                     CLR             TI

                +1   884                     

0A1F 22         +1   885                     RET

                +1   886     

                +1   887     

                +1   888     

                +1   889     

                +1   890     

                +1   891     

                +1   892     

                +1   893     

0A20            +1   894     ENVIA_OK:

0A20 C299       +1   895                     CLR     TI

                +1   896                     

0A22 744F       +1   897                     MOV     A,    #'O'

0A24 F599       +1   898                     MOV             SBUF, A

                +1   899                     

0A26 3099FD     +1   900                     JNB             TI,   $

                +1   901                     

0A29 C299       +1   902                     CLR             TI      

                +1   903                     

0A2B 744B       +1   904                     MOV     A,    #'K'

0A2D F599       +1   905                     MOV     SBUF, A

                +1   906                     

0A2F 3099FD     +1   907                     JNB     TI,   $

                +1   908                     

0A32 C299       +1   909                     CLR             TI

                +1   910                     

0A34 22         +1   911                     RET

                     912     

                     913     ;#include "i2c_twi.a51"

                +1   914     

                +1   915     

A51 MACRO ASSEMBLER  PROJETO_03_RFID                                                      05/19/2017 14:59:02 PAGE    15

                +1   916     

                +1   917     

                +1   918     

                +1   919     

                +1   920     

                +1   921     

                +1   922     

0800            +1   923     ORG     0800h

                +1   924     

                +1   925     

  0040          +1   926     SSIE    EQU 0x40

  0020          +1   927     STA             EQU 0x20

  0010          +1   928     STO             EQU 0x10        

  0008          +1   929     SI              EQU 0x08

  0004          +1   930     AA              EQU 0x04

                +1   931             

                +1   932     

  00C1          +1   933     I2C_SDA EQU P4.1

  00C0          +1   934     I2C_SCL EQU P4.0

                +1   935             

                +1   936     

  005D          +1   937     B2W             EQU 005Dh        

  005E          +1   938     B2R     EQU 005Eh        

  005F          +1   939     ADDR    EQU 005Fh        

  0060          +1   940     DBASE   EQU 0060h        

                +1   941             

  0061          +1   942     NACKS   EQU 0061h        

                +1   943             

                +1   944     

                +1   945     

  0000          +1   946     I2C_BUSY EQU 00h  

                +1   947             

                +1   948     

                +1   949     

                +1   950     

                +1   951     

                +1   952     

                +1   953     

                +1   954     

                +1   955     

0800            +1   956     i2c_int:

0800 E594       +1   957                     MOV     A, SSCS  

0802 03         +1   958                     RR              A                

                +1   959     

0803 120887     +1   960                     LCALL   decode  

                +1   961                                                                              

                +1   962                     

                +1   963                     

                +1   964                     

                +1   965                     

                +1   966                     

                +1   967                     

                +1   968                     

                +1   969                     

                +1   970                     

                +1   971                     

                +1   972                     

0806 02089C     +1   973                     LJMP    ERRO  

0809 00         +1   974                     NOP

                +1   975                     

                +1   976                     

080A 0208A7     +1   977                     LJMP    START

080D 00         +1   978                     NOP     

                +1   979                     

                +1   980                     

080E 0208B5     +1   981                     LJMP    RESTART

A51 MACRO ASSEMBLER  PROJETO_03_RFID                                                      05/19/2017 14:59:02 PAGE    16

0811 00         +1   982                     NOP

                +1   983                     

                +1   984                     

0812 0208C1     +1   985                     LJMP    W_ADDR_ACK

0815 00         +1   986                     NOP

                +1   987                     

                +1   988                     

0816 0208CD     +1   989                     LJMP    W_ADDR_NACK

0819 00         +1   990                     NOP

                +1   991                     

                +1   992                     

081A 0208DC     +1   993                     LJMP    W_DATA_ACK

081D 00         +1   994                     NOP

                +1   995                     

                +1   996                     

081E 020909     +1   997                     LJMP    W_DATA_NACK

0821 00         +1   998                     NOP

                +1   999                     

                +1  1000                     

0822 020916     +1  1001                     LJMP    ARB_LOST

0825 00         +1  1002                     NOP

                +1  1003                     

                +1  1004                     

0826 020919     +1  1005                     LJMP    R_ADDR_ACK

0829 00         +1  1006                     NOP

                +1  1007                     

                +1  1008                     

082A 02092B     +1  1009                     LJMP    R_ADDR_NACK

082D 00         +1  1010                     NOP

                +1  1011                     

                +1  1012                     

082E 02093A     +1  1013                     LJMP    R_DATA_ACK

0831 00         +1  1014                     NOP

                +1  1015                     

                +1  1016                     

0832 020952     +1  1017                     LJMP    R_DATA_NACK

0835 00         +1  1018                     NOP

                +1  1019     

                +1  1020                     

0836 020886     +1  1021                     LJMP    not_impl

0839 00         +1  1022                     NOP  

                +1  1023                     

083A 020886     +1  1024                     LJMP    not_impl

083D 00         +1  1025                     NOP  

                +1  1026                     

083E 020886     +1  1027                     LJMP    not_impl

0841 00         +1  1028                     NOP  

                +1  1029                     

0842 020886     +1  1030                     LJMP    not_impl

0845 00         +1  1031                     NOP  

                +1  1032                     

0846 020886     +1  1033                     LJMP    not_impl

0849 00         +1  1034                     NOP  

                +1  1035                     

084A 020886     +1  1036                     LJMP    not_impl

084D 00         +1  1037                     NOP  

                +1  1038                     

084E 020886     +1  1039                     LJMP    not_impl

0851 00         +1  1040                     NOP  

                +1  1041                     

0852 020886     +1  1042                     LJMP    not_impl

0855 00         +1  1043                     NOP  

                +1  1044                     

0856 020886     +1  1045                     LJMP    not_impl

0859 00         +1  1046                     NOP  

                +1  1047                     

A51 MACRO ASSEMBLER  PROJETO_03_RFID                                                      05/19/2017 14:59:02 PAGE    17

                +1  1048                     

085A 020886     +1  1049                     LJMP    not_impl

085D 00         +1  1050                     NOP  

                +1  1051                     

085E 020886     +1  1052                     LJMP    not_impl

0861 00         +1  1053                     NOP  

                +1  1054                     

0862 020886     +1  1055                     LJMP    not_impl

0865 00         +1  1056                     NOP  

                +1  1057                     

0866 020886     +1  1058                     LJMP    not_impl

0869 00         +1  1059                     NOP  

                +1  1060                     

086A 020886     +1  1061                     LJMP    not_impl

086D 00         +1  1062                     NOP  

                +1  1063     

                +1  1064                     

086E 020886     +1  1065                     LJMP    not_impl

0871 00         +1  1066                     NOP  

                +1  1067                     

0872 020886     +1  1068                     LJMP    not_impl

0875 00         +1  1069                     NOP  

                +1  1070                     

0876 020886     +1  1071                     LJMP    not_impl

0879 00         +1  1072                     NOP  

                +1  1073                     

087A 020886     +1  1074                     LJMP    not_impl

087D 00         +1  1075                     NOP  

                +1  1076                     

087E 020886     +1  1077                     LJMP    not_impl

0881 00         +1  1078                     NOP  

                +1  1079     

                +1  1080                     

0882 020886     +1  1081                     LJMP    end_i2c_int

0885 00         +1  1082                     NOP  

                +1  1083     

0886            +1  1084     not_impl:

0886            +1  1085     end_i2c_int:

0886 32         +1  1086                     RETI

                +1  1087                     

                +1  1088     

                +1  1089     

                +1  1090     

0887            +1  1091     decode:

                +1  1092                     

0887 D083       +1  1093                     POP DPH

0889 D082       +1  1094                     POP DPL                 

                +1  1095                     

088B 2582       +1  1096                     ADD A,   DPL

088D F582       +1  1097                     MOV DPL, A               

                +1  1098                     

088F 5006       +1  1099                     JNC termina

                +1  1100                     

0891 7401       +1  1101                     MOV A,   #1

0893 2583       +1  1102                     ADD A,   DPH             

0895 F583       +1  1103                     MOV DPH, A

                +1  1104     

0897            +1  1105     termina:

                +1  1106                     

0897 C082       +1  1107                     PUSH DPL                

0899 C083       +1  1108                     PUSH DPH                

                +1  1109     

089B 22         +1  1110                     RET

                +1  1111             

                +1  1112     

                +1  1113     

A51 MACRO ASSEMBLER  PROJETO_03_RFID                                                      05/19/2017 14:59:02 PAGE    18

                +1  1114     

                +1  1115     

                +1  1116     

                +1  1117     

                +1  1118     

089C            +1  1119     ERRO:

089C E593       +1  1120                     MOV             A, SSCON

089E 5410       +1  1121                     ANL A, #STO ; gera um stop

08A0 F593       +1  1122                     MOV SSCON, A

08A2 C200       +1  1123                     CLR     I2C_BUSY ; zera o flag de ocupado

08A4 020886     +1  1124                     LJMP end_i2c_int

                +1  1125     ;------------------------------------------------------------------------------

08A7            +1  1126     START:

                +1  1127     ; um start SEMPRE vai ocasionar uma escrita

                +1  1128     ; pois para ler, preciso primeiro escrever de onde vou ler!

                +1  1129     ; SSDAT = SLA + W

                +1  1130     ; STO = 0 e SI = 0

08A7 D200       +1  1131             SETB I2C_BUSY           ; seta o flag de ocupado

08A9 7595D0     +1  1132             MOV SSDAT, #WADDR

08AC E593       +1  1133             MOV A, SSCON

08AE 54E7       +1  1134             ANL A, #~(STO | SI)     ; zera os bits STO e SI

08B0 F593       +1  1135             MOV SSCON, A

08B2 020886     +1  1136             LJMP end_i2c_int

                +1  1137     ;------------------------------------------------------------------------------

08B5            +1  1138     RESTART:

                +1  1139     ; o Restart ser utilizado apenas para leituras,

                +1  1140     ; onde h a necessidade de fazer um start->escrita->restart->leitura->stop

                +1  1141     ; SSDAT = SLA + R

                +1  1142     ; STO = 0 e SI = 0

08B5 7595D1     +1  1143             MOV SSDAT, #RADDR

08B8 E593       +1  1144             MOV A, SSCON

08BA 54E7       +1  1145             ANL A, #~(STO | SI)     ; zera os bits STO e SI

08BC F593       +1  1146             MOV SSCON, A

08BE 020886     +1  1147             LJMP end_i2c_int

                +1  1148     ;------------------------------------------------------------------------------

08C1            +1  1149     W_ADDR_ACK:

                +1  1150     ; aps um W_addr_ack temos que escrever o registrador interno!

                +1  1151     ; SSDAT = ADDR

                +1  1152     ; STA = 0, STO = 0, SI = 0

08C1 855F95     +1  1153             MOV SSDAT, ADDR

08C4 E593       +1  1154             MOV A, SSCON

08C6 54C7       +1  1155             ANL A, #~(STA | STO | SI)       ; zera os bits STA, STO e SI

08C8 F593       +1  1156             MOV SSCON, A

08CA 020886     +1  1157             LJMP end_i2c_int

                +1  1158     ;------------------------------------------------------------------------------

08CD            +1  1159     W_ADDR_NACK:

                +1  1160     ; em caso de nack, ou o end ta errado ou o slave no est conectado.

                +1  1161     ; no vamos fazer retry, encerramos a comunicao.

                +1  1162     ; STA = 0, SI = 0

                +1  1163     ; STO = 1

08CD E593       +1  1164             MOV A, SSCON

08CF 54D7       +1  1165             ANL A, #~(STA | SI)     ; zera os bits STA e SI

08D1 4410       +1  1166             ORL A, #STO                                     ; seta STO

08D3 F593       +1  1167             MOV SSCON, A

08D5 C200       +1  1168             CLR     I2C_BUSY ; zera o flag de ocupado //correo rev2 RdG

08D7 0561       +1  1169             INC NACKS

                +1  1170     

08D9 020886     +1  1171             LJMP end_i2c_int

                +1  1172             

                +1  1173     ;------------------------------------------------------------------------------

08DC            +1  1174     W_DATA_ACK:

                +1  1175     ; aps o primeiro data ack (registrador interno) temos 2 opes:

                +1  1176     ; 1 - escrever um novo byte

                +1  1177     ; 2 - gerar um restart para leitura

08DC D55D1B     +1  1178             DJNZ B2W, wda1          ; enquanto tiver bytes para escrever, pula para wda1

                +1  1179     

A51 MACRO ASSEMBLER  PROJETO_03_RFID                                                      05/19/2017 14:59:02 PAGE    19

                +1  1180             ; se no tiver mais bytes para escrever, comee a ler

08DF D55E0D     +1  1181             DJNZ B2R, wda2          ;se tiver algum byte pra ler, pula para wd

08E2 E593       +1  1182             MOV A, SSCON 

08E4 54D7       +1  1183             ANL A, #~(STA | SI)     ; seno..

08E6 4410       +1  1184             ORL A, #STO                     ; gera um STOP

08E8 F593       +1  1185             MOV SSCON, A

08EA C200       +1  1186             CLR     I2C_BUSY ; zera o flag de ocupado

08EC 020886     +1  1187             LJMP end_i2c_int

08EF            +1  1188     wda2:

08EF E593       +1  1189             MOV A, SSCON 

08F1 54E7       +1  1190             ANL A, #~(STO | SI)

08F3 4420       +1  1191             ORL A, #STA                     ; ..gera um restart!

08F5 F593       +1  1192             MOV SSCON, A

08F7 020886     +1  1193             LJMP end_i2c_int

08FA            +1  1194     wda1:

08FA A860       +1  1195             MOV R0, DBASE

08FC 8695       +1  1196             MOV SSDAT, @R0  ; ...escreve o proximo!

08FE E593       +1  1197             MOV A, SSCON

0900 54C7       +1  1198             ANL A, #~(STA | STO | SI) ; zera STA, STO e SI

0902 F593       +1  1199             MOV SSCON, A

0904 0560       +1  1200             INC DBASE               ; incrementa o indice do buffer

0906 020886     +1  1201             LJMP end_i2c_int

                +1  1202     ;------------------------------------------------------------------------------

0909            +1  1203     W_DATA_NACK:

                +1  1204     ; aps um data_nack, podemos repetir ou encerrar

                +1  1205     ; vamos encerrar

0909 E593       +1  1206             MOV A, SSCON 

090B 54D7       +1  1207             ANL A, #~(STA | SI)

090D 4410       +1  1208             ORL A, #STO                     ; gera um STOP

090F F593       +1  1209             MOV SSCON, A

0911 C200       +1  1210             CLR     I2C_BUSY ; zera o flag de ocupado

0913 020886     +1  1211             LJMP end_i2c_int

                +1  1212     ;------------------------------------------------------------------------------

0916            +1  1213     ARB_LOST:

                +1  1214     ; aps um arb-lost podemos acabar sendo endereados como slave

                +1  1215     ; o arb-lost costuma ocorrer em 2 situaes:

                +1  1216     ; 1 - problemas fsicos no bus

                +1  1217     ; 2 - ambiente multi-master (no  o caso)

                +1  1218     ; em ambos os casos, no vamos fazer nada!

                +1  1219     ; pois no estamos implementando a comunicao em modo slave.

0916 020886     +1  1220             LJMP end_i2c_int        

                +1  1221     ;------------------------------------------------------------------------------

0919            +1  1222     R_ADDR_ACK:

                +1  1223     ; depois de um R ADDR ACK, recebemos os bytes!

0919 E593       +1  1224             MOV A, SSCON

091B 54C7       +1  1225             ANL A, #~(STA | STO | SI) ; receberemos o proximo byte

                +1  1226             

091D D55E04     +1  1227             DJNZ B2R, raa1                                    ; decrementa a quantidade de byte
                             s a receber!

                +1  1228             ; se der 0,  o ultimo byte a ser recebido

0920 54FB       +1  1229             ANL A, #~AA     ; retorne NACK

0922 8002       +1  1230             SJMP raa2

                +1  1231             ; se no...

0924            +1  1232     raa1:

0924 4404       +1  1233             ORL A, #AA      ; retorne ACK para o slave!

0926            +1  1234     raa2:   

0926 F593       +1  1235             MOV SSCON, A

0928 020886     +1  1236             LJMP end_i2c_int        

                +1  1237     ;------------------------------------------------------------------------------

092B            +1  1238     R_ADDR_NACK:

                +1  1239     ; idem ao w_addr_nack

092B E593       +1  1240             MOV A, SSCON 

092D 54D7       +1  1241             ANL A, #~(STA | SI)

092F 4410       +1  1242             ORL A, #STO                     ; gera um STOP

0931 F593       +1  1243             MOV SSCON, A

0933 C200       +1  1244             CLR     I2C_BUSY ; zera o flag de ocupado

A51 MACRO ASSEMBLER  PROJETO_03_RFID                                                      05/19/2017 14:59:02 PAGE    20

0935 0561       +1  1245             INC NACKS

0937 020886     +1  1246             LJMP end_i2c_int

                +1  1247     ;------------------------------------------------------------------------------

093A            +1  1248     R_DATA_ACK:

                +1  1249     ; se tiver mais bytes pra ler, de um ack, seno de um nack

                +1  1250     

093A A860       +1  1251             MOV R0, DBASE

093C A695       +1  1252             MOV     @R0, SSDAT ; le o byte que j chegou

                +1  1253     

093E E593       +1  1254             MOV A, SSCON

0940 54C7       +1  1255             ANL A, #~(STA | STO | SI) ; receberemos o proximo byte

                +1  1256             

0942 D55E04     +1  1257             DJNZ B2R, rda1                                    ; decrementa a quantidade de byte
                             s a receber!

                +1  1258             ; se der 0,  o ultimo byte a ser recebido

0945 54FB       +1  1259             ANL A, #~AA     ; retorne NACK

0947 8002       +1  1260             SJMP rda2

                +1  1261             ; se no...

0949            +1  1262     rda1:

0949 4404       +1  1263             ORL A, #AA      ; retorne ACK para o slave!

094B            +1  1264     rda2:   

094B F593       +1  1265             MOV SSCON, A

094D 0560       +1  1266             INC DBASE ; incrementa o buffer

094F 020886     +1  1267             LJMP end_i2c_int

                +1  1268     ;------------------------------------------------------------------------------

0952            +1  1269     R_DATA_NACK:

                +1  1270     ; salva o ultimo byte e termina

                +1  1271     

0952 A860       +1  1272             MOV R0, DBASE

0954 A695       +1  1273             MOV     @R0, SSDAT ; le o byte que j chegou

                +1  1274     

0956 E593       +1  1275             MOV A, SSCON 

0958 54D7       +1  1276             ANL A, #~(STA | SI)

095A 4410       +1  1277             ORL A, #STO                     ; gera um STOP

095C F593       +1  1278             MOV SSCON, A

                +1  1279     

095E 0560       +1  1280             INC DBASE ; inc o buffer

                +1  1281     

0960 C200       +1  1282             CLR     I2C_BUSY ; zera o flag de ocupado

0962 020886     +1  1283             LJMP end_i2c_int        

                    1284     

                    1285     ;#include "rtc.a51"

                +1  1286     

                +1  1287     

                +1  1288     

                +1  1289     

                +1  1290     

                +1  1291     

                +1  1292     

                +1  1293     

                +1  1294     

0700            +1  1295     ORG     0700h

                +1  1296     

                +1  1297     

  00D1          +1  1298     RADDR   EQU 0xD1

  00D0          +1  1299     WADDR   EQU 0xD0

                +1  1300             

                +1  1301     

  00A1          +1  1302     RTC_SQW EQU P2.1

                +1  1303             

                +1  1304     

  0050          +1  1305     SEC     EQU 0050h

  0051          +1  1306     MIN     EQU 0051h

  0052          +1  1307     HOU     EQU 0052h

  0053          +1  1308     DAY     EQU 0053h

  0054          +1  1309     DAT     EQU 0054h

A51 MACRO ASSEMBLER  PROJETO_03_RFID                                                      05/19/2017 14:59:02 PAGE    21

  0055          +1  1310     MON     EQU 0055h

  0056          +1  1311     YEA     EQU 0056h

  0057          +1  1312     CTR     EQU 0057h

  0058          +1  1313     LSB             EQU     0058h

  0059          +1  1314     MSB             EQU 0059h

                +1  1315             

  005A          +1  1316     MULT    EQU 005Ah  

  005B          +1  1317     T_OUT   EQU 005Bh ; time-out de espera do fim da comunicacao

  005C          +1  1318     T_OUTS  EQU 005Ch ; contador do numero de time_outs para estatstica

                +1  1319             

                +1  1320     

                +1  1321     

                +1  1322     

                +1  1323     

                +1  1324     

                +1  1325     

                +1  1326     

                +1  1327     

                +1  1328     

                +1  1329     

                +1  1330     

                +1  1331     

                +1  1332     

                +1  1333     

0700            +1  1334     INIT_RTC:

                +1  1335                     

0700 75A800     +1  1336                     MOV IEN0, #00h

0703 75B100     +1  1337                     MOV IEN1, #00h

                +1  1338     

                +1  1339                     

0706 758901     +1  1340                     MOV TMOD, #01h  

                +1  1341     

                +1  1342                     

0709 D2C0       +1  1343                     SETB I2C_SCL

070B D2C1       +1  1344                     SETB I2C_SDA     

                +1  1345     

                +1  1346                     

070D 759341     +1  1347                     MOV SSCON, #01000001b

                +1  1348                                       

                +1  1349                                       

                +1  1350                                       

                +1  1351                                       

                +1  1352                                       

                +1  1353                                       

                +1  1354                                       

                +1  1355                                       

                +1  1356     

                +1  1357                     

0710 75B202     +1  1358                     MOV IPL1, #0x02

0713 75B302     +1  1359                     MOV IPH1, #0x02

0716 75B102     +1  1360                     MOV IEN1, #0x02  

                +1  1361     

0719 D2AF       +1  1362                     SETB EA  

                +1  1363                     

                +1  1364                     

                +1  1365                     

                +1  1366                     

                +1  1367                     

071B 8850       +1  1368                     MOV SEC, R0  

071D 8951       +1  1369                     MOV MIN, R1  

071F 8A52       +1  1370                     MOV HOU, R2  

0721 8B53       +1  1371                     MOV DAY, R3  

0723 8C54       +1  1372                     MOV DAT, R4  

0725 8D55       +1  1373                     MOV MON, R5  

0727 8E56       +1  1374                     MOV YEA, R6  

0729 8F57       +1  1375                     MOV CTR, R7  

A51 MACRO ASSEMBLER  PROJETO_03_RFID                                                      05/19/2017 14:59:02 PAGE    22

                +1  1376     

072B 12072F     +1  1377                     LCALL RTC_SET_TIME

                +1  1378                     

072E 22         +1  1379                     RET

                +1  1380             

                +1  1381     

                +1  1382     

                +1  1383     

                +1  1384     

                +1  1385     

                +1  1386     

                +1  1387     

072F            +1  1388     RTC_SET_TIME:

072F 755F00     +1  1389                     MOV ADDR,  #00h          

0732 755D09     +1  1390                     MOV B2W,   #(8+1)        

0735 755E01     +1  1391                     MOV B2R,   #(0+1)        

0738 756050     +1  1392                     MOV DBASE, #SEC          

                +1  1393     

                +1  1394                     

073B E593       +1  1395                     MOV A,          SSCON

073D 4420       +1  1396                     ORL A,          #STA

073F F593       +1  1397                     MOV SSCON,      A

                +1  1398     

                +1  1399                     

0741 7A00       +1  1400                     MOV             R2, #000h

0743 7900       +1  1401                     MOV             R1, #000h

0745 780A       +1  1402                     MOV             R0, #00Ah

0747 120D3D     +1  1403                     LCALL   TIMER_DELAY

                +1  1404     

                +1  1405                     

074A 755B1E     +1  1406                     MOV T_OUT, #1Eh

                +1  1407                     

074D            +1  1408     set_wait:

074D 30000E     +1  1409                     JNB I2C_BUSY, end_set

                +1  1410                     

                +1  1411                     

0750 7A00       +1  1412                     MOV             R2, #000h

0752 7900       +1  1413                     MOV             R1, #000h

0754 7810       +1  1414                     MOV             R0, #010h

0756 120D3D     +1  1415                     LCALL   TIMER_DELAY

                +1  1416                     

0759 D55BF1     +1  1417                     DJNZ T_OUT,set_wait

075C 055C       +1  1418                     INC T_OUTS

                +1  1419                     

075E            +1  1420     end_set:

075E 22         +1  1421                     RET

                +1  1422                     

                +1  1423     

                +1  1424     

                +1  1425     

                +1  1426     

                +1  1427     

                +1  1428     

                +1  1429     

075F            +1  1430     RTC_GET_TIME:

075F 755F00     +1  1431                     MOV ADDR,  #000h         

0762 755D01     +1  1432                     MOV B2W,   #(0+1)        

0765 755E09     +1  1433                     MOV B2R,   #(8+1)        

0768 756050     +1  1434                     MOV DBASE, #SEC          

                +1  1435     

                +1  1436                     

076B E593       +1  1437                     MOV A,          SSCON

076D 4420       +1  1438                     ORL A,          #STA

076F F593       +1  1439                     MOV SSCON,      A

                +1  1440     

                +1  1441                     

A51 MACRO ASSEMBLER  PROJETO_03_RFID                                                      05/19/2017 14:59:02 PAGE    23

0771 7A00       +1  1442                     MOV             R2, #000h

0773 7900       +1  1443                     MOV             R1, #000h

0775 780A       +1  1444                     MOV             R0, #00Ah

0777 120D3D     +1  1445                     LCALL   TIMER_DELAY

                +1  1446     

                +1  1447                     

077A 755B1E     +1  1448                     MOV T_OUT, #1Eh

                +1  1449     

077D            +1  1450     get_wait:

077D 30000E     +1  1451                     JNB I2C_BUSY, end_get

                +1  1452                     

                +1  1453                     

0780 7A00       +1  1454                     MOV             R2, #000h

0782 7900       +1  1455                     MOV             R1, #000h

0784 7810       +1  1456                     MOV             R0, #010h

0786 120D3D     +1  1457                     LCALL   TIMER_DELAY

                +1  1458                     

0789 D55BF1     +1  1459                     DJNZ    T_OUT,get_wait

078C 055C       +1  1460                     INC     T_OUTS

                +1  1461     

078E            +1  1462     end_get:

078E 22         +1  1463                     RET

                    1464     

                    1465     

078F                1466     DOMINGO:

078F 444F4D00       1467                     DB              'DOM', 00H

0793                1468     SEGUNDA:

0793 53454700       1469                     DB              'SEG', 00H

0797                1470     TERCA:

0797 54455200       1471                     DB              'TER', 00H

079B                1472     QUARTA:

079B 51554100       1473                     DB              'QUA', 00H

079F                1474     QUINTA:

079F 51554900       1475                     DB              'QUI', 00H

07A3                1476     SEXTA:

07A3 53455800       1477                     DB              'SEX', 00H

07A7                1478     SABADO:

07A7 53414200       1479                     DB              'SAB', 00H

                    1480     

                    1481     

                    1482     

                    1483     

                    1484     

                    1485     

                    1486     

                    1487     

0000                1488     ORG 0000h  

0000 020046         1489                     LJMP __STARTUP__

                    1490     

0003                1491     ORG 0003h  

0003 02031F         1492                     LJMP INT_INT0

                    1493     

000B                1494     ORG 000Bh  

000B 020320         1495                     LJMP INT_TIMER0

                    1496     

0013                1497     ORG 0013h  

0013 020321         1498                     LJMP INT_INT1

                    1499     

001B                1500     ORG 001Bh  

001B 020322         1501                     LJMP INT_TIMER1

                    1502     

0023                1503     ORG 0023h  

0023 020323         1504                     LJMP INT_SERIAL

                    1505     

0043                1506     ORG     0043h

0043 020324         1507                     LJMP INT_I2C_TWI

A51 MACRO ASSEMBLER  PROJETO_03_RFID                                                      05/19/2017 14:59:02 PAGE    24

                    1508             

0046                1509     __STARTUP__:

                    1510                     

0046 7800           1511                     MOV R0, #000h           

0048 7900           1512                     MOV R1, #000h           

004A 7A15           1513                     MOV R2, #015h           

004C 7B06           1514                     MOV R3, #006h           

004E 7C19           1515                     MOV R4, #019h           

0050 7D05           1516                     MOV R5, #005h           

0052 7E17           1517                     MOV R6, #017h           

0054 7F12           1518                     MOV R7, #00010010b   

0056 120700         1519                     LCALL   INIT_RTC

                    1520                     

0059 120F00         1521                     LCALL   INIDISP

                    1522                     

005C 755712         1523                     MOV     CTR, #00010010b

                    1524                     

005F 7921           1525                     MOV     R1, #00100001b   

0061 78F3           1526                     MOV     R0, #0F3h                

0063 120A09         1527                     LCALL   CONFIGURA_BAUD_RATE

                    1528                     

0066 7950           1529                     MOV     R1, #01010000b

0068 7880           1530                     MOV     R0, #10000000b

006A 120A00         1531                     LCALL   CONFIGURA_SERIAL

                    1532                     

006D                1533     main:

006D 020206         1534                     LJMP    LOOP

                    1535             

0070                1536     ESPERA_DADOS:

0070 120A10         1537             LCALL   RECEBE_DADO

0073 B401F7         1538             CJNE    A, #01h, main

0076 120A10         1539             LCALL   RECEBE_DADO

0079 F550           1540             MOV     SEC, A ; BCD segundos, deve ser iniciado com valor PAR para o relogio funci
                             onar.

007B 120A10         1541             LCALL   RECEBE_DADO

007E F551           1542             MOV     MIN, A ; BCD minutos

0080 120A10         1543             LCALL   RECEBE_DADO

0083 F552           1544             MOV     HOU, A; BCD hora, se o bit mais alto for 1, o relgio  12h, seno BCD 24h

0085 120A10         1545             LCALL   RECEBE_DADO

0088 F553           1546             MOV     DAY, A ; Dia da semana

008A 120A10         1547             LCALL   RECEBE_DADO

008D F554           1548             MOV     DAT, A ; Dia

008F 120A10         1549             LCALL   RECEBE_DADO

0092 F555           1550             MOV     MON, A ; Ms

0094 120A10         1551             LCALL   RECEBE_DADO

0097 F556           1552             MOV     YEA, A ; Ano

0099 120A10         1553             LCALL   RECEBE_DADO

009C F557           1554             MOV     CTR, A ; CONTROLE

009E 120A20         1555             LCALL   ENVIA_OK

00A1 12072F         1556             LCALL   RTC_SET_TIME

00A4 755792         1557             MOV     CTR, #10010010b

00A7 4106           1558             JMP     LOOP

                    1559     

00A9                1560     EHOSW2: 

00A9 7453           1561             MOV     A, #'S'

00AB 120A18         1562             LCALL   ENVIA_DADO

00AE 7A32           1563             MOV     R2, #50

00B0 120343         1564             LCALL   ATRASO_MS

00B3 7457           1565             MOV     A, #'W'

00B5 120A18         1566             LCALL   ENVIA_DADO

00B8 7A32           1567             MOV     R2, #50

00BA 120343         1568             LCALL   ATRASO_MS

00BD 7432           1569             MOV     A, #32h

00BF 120A18         1570             LCALL   ENVIA_DADO

00C2 7A32           1571             MOV     R2, #50

00C4 120343         1572             LCALL   ATRASO_MS

A51 MACRO ASSEMBLER  PROJETO_03_RFID                                                      05/19/2017 14:59:02 PAGE    25

                    1573             

00C7                1574     CONTINUA_ENVIAR:

00C7 7420           1575             MOV     A, #20h ;Manda (espao)

00C9 120A18         1576             LCALL   ENVIA_DADO

00CC 7A32           1577             MOV     R2, #50

00CE 120343         1578             LCALL   ATRASO_MS

00D1 742D           1579             MOV     A, #2Dh ;Manda (-)

00D3 120A18         1580             LCALL   ENVIA_DADO

00D6 7A32           1581             MOV     R2, #50

00D8 120343         1582             LCALL   ATRASO_MS

00DB 7420           1583             MOV     A, #20h ;Manda (espao)

00DD 120A18         1584             LCALL   ENVIA_DADO

00E0 7A32           1585             MOV     R2, #50

00E2 120343         1586             LCALL   ATRASO_MS

00E5 7441           1587             MOV     A, #'A'

00E7 120A18         1588             LCALL   ENVIA_DADO

00EA 7A32           1589             MOV     R2, #50

00EC 120343         1590             LCALL   ATRASO_MS

00EF 7463           1591             MOV     A, #'c'

00F1 120A18         1592             LCALL   ENVIA_DADO

00F4 7A32           1593             MOV     R2, #50

00F6 120343         1594             LCALL   ATRASO_MS

00F9 7469           1595             MOV     A, #'i'

00FB 120A18         1596             LCALL   ENVIA_DADO

00FE 7A32           1597             MOV     R2, #50

0100 120343         1598             LCALL   ATRASO_MS

0103 746F           1599             MOV     A, #'o'

0105 120A18         1600             LCALL   ENVIA_DADO

0108 7A32           1601             MOV     R2, #50

010A 120343         1602             LCALL   ATRASO_MS

010D 746E           1603             MOV     A, #'n'

010F 120A18         1604             LCALL   ENVIA_DADO

0112 7A32           1605             MOV     R2, #50

0114 120343         1606             LCALL   ATRASO_MS

0117 7461           1607             MOV     A, #'a'

0119 120A18         1608             LCALL   ENVIA_DADO

011C 7A32           1609             MOV     R2, #50

011E 120343         1610             LCALL   ATRASO_MS

0121 7464           1611             MOV     A, #'d'

0123 120A18         1612             LCALL   ENVIA_DADO

0126 7A32           1613             MOV     R2, #50

0128 120343         1614             LCALL   ATRASO_MS

012B 746F           1615             MOV     A, #'o'

012D 120A18         1616             LCALL   ENVIA_DADO

0130 7A32           1617             MOV     R2, #50

0132 120343         1618             LCALL   ATRASO_MS

0135 7420           1619             MOV     A, #20h

0137 120A18         1620             LCALL   ENVIA_DADO

013A 7A32           1621             MOV     R2, #50

013C 120343         1622             LCALL   ATRASO_MS

013F 7461           1623             MOV     A, #'a'

0141 120A18         1624             LCALL   ENVIA_DADO

0144 7A32           1625             MOV     R2, #50

0146 120343         1626             LCALL   ATRASO_MS

0149 7473           1627             MOV     A, #'s'

014B 120A18         1628             LCALL   ENVIA_DADO

014E 7A32           1629             MOV     R2, #50

0150 120343         1630             LCALL   ATRASO_MS

0153 7420           1631             MOV     A, #20h

0155 120A18         1632             LCALL   ENVIA_DADO

0158 7A32           1633             MOV     R2, #50

015A 120343         1634             LCALL   ATRASO_MS

015D E552           1635             MOV     A, HOU ;Manda horas

015F 12022E         1636             LCALL   CONVERTE_BCD

0162 E559           1637             MOV             A, MSB

0164 2430           1638             ADD             A, #30h

A51 MACRO ASSEMBLER  PROJETO_03_RFID                                                      05/19/2017 14:59:02 PAGE    26

0166 120A18         1639             LCALL   ENVIA_DADO

0169 7A32           1640             MOV     R2, #50

016B 120343         1641             LCALL   ATRASO_MS

016E E558           1642             MOV             A,      LSB

0170 2430           1643             ADD             A, #30h

0172 120A18         1644             LCALL   ENVIA_DADO

0175 743A           1645             MOV     A, #03Ah ;Manda (:)

0177 120A18         1646             LCALL   ENVIA_DADO

017A E551           1647             MOV     A, MIN ;Manda minutos

017C 12022E         1648             LCALL   CONVERTE_BCD

017F E559           1649             MOV             A, MSB

0181 2430           1650             ADD             A, #30h

0183 120A18         1651             LCALL   ENVIA_DADO

0186 E558           1652             MOV             A,      LSB

0188 2430           1653             ADD             A, #30h

018A 120A18         1654             LCALL   ENVIA_DADO

018D 743A           1655             MOV     A, #03Ah ;Manda (:)

018F 120A18         1656             LCALL   ENVIA_DADO

0192 E550           1657             MOV     A, SEC ;Manda segundos

0194 12022E         1658             LCALL   CONVERTE_BCD

0197 E559           1659             MOV             A, MSB

0199 2430           1660             ADD             A, #30h

019B 120A18         1661             LCALL   ENVIA_DADO

019E E558           1662             MOV             A,      LSB

01A0 2430           1663             ADD             A, #30h

01A2 120A18         1664             LCALL   ENVIA_DADO

01A5 7420           1665             MOV     A, #20h ;Manda (espao)

01A7 120A18         1666             LCALL   ENVIA_DADO

01AA 742D           1667             MOV     A, #2Dh ;Manda (-)

01AC 120A18         1668             LCALL   ENVIA_DADO

01AF 7420           1669             MOV     A, #20h ;Manda (espao)

01B1 120A18         1670             LCALL   ENVIA_DADO

01B4 E554           1671             MOV     A, DAT ;Manda dia

01B6 12022E         1672             LCALL   CONVERTE_BCD

01B9 E559           1673             MOV             A, MSB

01BB 2430           1674             ADD             A, #30h

01BD 120A18         1675             LCALL   ENVIA_DADO

01C0 E558           1676             MOV             A,      LSB

01C2 2430           1677             ADD             A, #30h

01C4 120A18         1678             LCALL   ENVIA_DADO

01C7 742F           1679             MOV     A, #2Fh ;Manda (/)

01C9 120A18         1680             LCALL   ENVIA_DADO

01CC E555           1681             MOV     A, MON ;Manda mes

01CE 12022E         1682             LCALL   CONVERTE_BCD

01D1 E559           1683             MOV             A, MSB

01D3 2430           1684             ADD             A, #30h

01D5 120A18         1685             LCALL   ENVIA_DADO

01D8 E558           1686             MOV             A,      LSB

01DA 2430           1687             ADD             A, #30h

01DC 120A18         1688             LCALL   ENVIA_DADO

01DF 742F           1689             MOV     A, #2Fh ;Manda (/)

01E1 120A18         1690             LCALL   ENVIA_DADO

01E4 E556           1691             MOV     A, YEA ; Manda ano

01E6 12022E         1692             LCALL   CONVERTE_BCD

01E9 E559           1693             MOV             A, MSB

01EB 2430           1694             ADD             A, #30h

01ED 120A18         1695             LCALL   ENVIA_DADO

01F0 E558           1696             MOV             A,      LSB

01F2 2430           1697             ADD             A, #30h

01F4 120A18         1698             LCALL   ENVIA_DADO

01F7 7420           1699             MOV     A, #20h ;Manda (espao)

01F9 120A18         1700             LCALL   ENVIA_DADO

01FC 740D           1701             MOV     A, #0Dh ;Retorno ao inicio da linha

01FE 120A18         1702             LCALL   ENVIA_DADO

0201 740A           1703             MOV     A, #0Ah ; Nova linha

0203 120A18         1704             LCALL   ENVIA_DADO

A51 MACRO ASSEMBLER  PROJETO_03_RFID                                                      05/19/2017 14:59:02 PAGE    27

                    1705     

                    1706     ;------------------------------------------------------------------------------

                    1707     ;Ler o RTC periodicamente

                    1708     ;------------------------------------------------------------------------------

0206                1709     LOOP:

0206 7A32           1710             MOV     R2, #50

0208 120343         1711             LCALL   ATRASO_MS

020B 30980A         1712             JNB     RI, tanormal

020E C298           1713             CLR             RI

0210 E599           1714             MOV             A, SBUF

0212 B4AA03         1715             CJNE    A, #0AAh, tanormal

0215 020070         1716             LJMP    ESPERA_DADOS

0218                1717     tanormal:

0218 8000           1718             JMP     reload

                    1719     

                    1720     

                    1721     

                    1722     

                    1723     

                    1724     

021A                1725     reload:

021A 7E01           1726             MOV     R6, #0x01               ; 1x

021C                1727     again:

021C 755AA0         1728             MOV     MULT, #0xA0     ; 250x

021F 12032A         1729             LCALL   runT0                   ; 0.5ms

0222 DEF8           1730             DJNZ    R6, again               ; = 125 ms

                    1731     ;       DJNZ    R7, reload              ; 125 ms x 4 = 0,5s

0224 12075F         1732             LCALL   RTC_GET_TIME

0227 B2B6           1733             CPL     P3.6                    ; toggle no led

0229 12023C         1734             LCALL   ATUALIZA_DISPLAY

022C 80D8           1735             JMP     LOOP;

                    1736     

                    1737     ;entra: A

                    1738     ;sai:   LSB, MSB

022E                1739     CONVERTE_BCD:

022E C0E0           1740             PUSH    ACC

0230 540F           1741             ANL             A, #0Fh

0232 F558           1742             MOV     LSB, A

0234 D0E0           1743             POP             ACC

0236 C4             1744             SWAP    A

0237 540F           1745             ANL             A, #0Fh

0239 F559           1746             MOV             MSB, A

023B 22             1747             RET

                    1748             

023C                1749     ATUALIZA_DISPLAY:

023C 120F48         1750             LCALL   CLR1L ;Clear na linha 1

023F E552           1751             MOV             A, HOU ;Atualiza hora

0241 12022E         1752             LCALL   CONVERTE_BCD

0244 E559           1753             MOV             A, MSB

0246 2430           1754             ADD             A, #30h

0248 120F7A         1755             LCALL   ESCDADO

024B E558           1756             MOV             A,      LSB

024D 2430           1757             ADD             A, #30h

024F 120F7A         1758             LCALL   ESCDADO

0252 743A           1759             MOV             A, #3Ah ;Manda (:)

0254 120F7A         1760             LCALL   ESCDADO

0257 E551           1761             MOV             A, MIN ;Atualiza minutos

0259 12022E         1762             LCALL   CONVERTE_BCD

025C E559           1763             MOV             A, MSB

025E 2430           1764             ADD             A, #30h

0260 120F7A         1765             LCALL   ESCDADO

0263 E558           1766             MOV             A,      LSB

0265 2430           1767             ADD             A, #30h

0267 120F7A         1768             LCALL   ESCDADO

026A 743A           1769             MOV             A, #3Ah ;Manda (:)

026C 120F7A         1770             LCALL   ESCDADO

A51 MACRO ASSEMBLER  PROJETO_03_RFID                                                      05/19/2017 14:59:02 PAGE    28

026F E550           1771             MOV             A, SEC ;Atualiza segundos

0271 12022E         1772             LCALL   CONVERTE_BCD

0274 E559           1773             MOV             A, MSB

0276 2430           1774             ADD             A, #30h

0278 120F7A         1775             LCALL   ESCDADO

027B E558           1776             MOV             A,      LSB

027D 2430           1777             ADD             A, #30h

027F 120F7A         1778             LCALL   ESCDADO

0282 120F61         1779             LCALL   CLR2L ;Clear na linha 2

0285 E554           1780             MOV             A, DAT ;Atualiza dia

0287 12022E         1781             LCALL   CONVERTE_BCD

028A E559           1782             MOV             A, MSB

028C 2430           1783             ADD             A, #30h

028E 120F7A         1784             LCALL   ESCDADO

0291 E558           1785             MOV             A,      LSB

0293 2430           1786             ADD             A, #30h

0295 120F7A         1787             LCALL   ESCDADO

0298 742F           1788             MOV             A, #2Fh ;Manda(/)

029A 120F7A         1789             LCALL   ESCDADO

029D E555           1790             MOV             A, MON ;Atualiza mes

029F 12022E         1791             LCALL   CONVERTE_BCD

02A2 E559           1792             MOV             A, MSB

02A4 2430           1793             ADD             A, #30h

02A6 120F7A         1794             LCALL   ESCDADO

02A9 E558           1795             MOV             A,      LSB

02AB 2430           1796             ADD             A, #30h

02AD 120F7A         1797             LCALL   ESCDADO

02B0 742F           1798             MOV             A, #2Fh ;Manda(/)

02B2 120F7A         1799             LCALL   ESCDADO

02B5 E556           1800             MOV             A, YEA ;Atualiza ano

02B7 12022E         1801             LCALL   CONVERTE_BCD

02BA E559           1802             MOV             A, MSB

02BC 2430           1803             ADD             A, #30h

02BE 120F7A         1804             LCALL   ESCDADO

02C1 E558           1805             MOV             A,      LSB

02C3 2430           1806             ADD             A, #30h

02C5 120F7A         1807             LCALL   ESCDADO

02C8 7420           1808             MOV             A, #20h ;Manda (espao)

02CA 120F7A         1809             LCALL   ESCDADO

02CD 742D           1810             MOV             A, #2Dh ;Manda(-)

02CF 120F7A         1811             LCALL   ESCDADO

02D2 7420           1812             MOV             A, #20h ;Manda (espao)

02D4 120F7A         1813             LCALL   ESCDADO

02D7 E553           1814             MOV             A, DAY ;Atualiza dia da semana

02D9 B40107         1815             CJNE A, #01, SEGU

02DC 90078F         1816             MOV      DPTR,#DOMINGO          ;STRING 

02DF 120F93         1817             LCALL    MSTRING 

02E2 22             1818             RET

                    1819             

02E3                1820     SEGU:

02E3 B40207         1821             CJNE    A, #02, TER

02E6 900793         1822             MOV     DPTR,#SEGUNDA           ;STRING 

02E9 120F93         1823             LCALL   MSTRING

02EC 22             1824             RET

02ED                1825     TER:

02ED B40307         1826             CJNE    A, #03, QUA

02F0 900797         1827             MOV     DPTR,#TERCA             ;STRING 

02F3 120F93         1828             LCALL   MSTRING

02F6 22             1829             RET

02F7                1830     QUA:

02F7 B40407         1831             CJNE    A, #04, QUI

02FA 90079B         1832             MOV     DPTR,#QUARTA            ;STRING 

02FD 120F93         1833             LCALL   MSTRING

0300 22             1834             RET

0301                1835     QUI:

0301 B40507         1836             CJNE    A, #05, SEX

A51 MACRO ASSEMBLER  PROJETO_03_RFID                                                      05/19/2017 14:59:02 PAGE    29

0304 90079F         1837             MOV     DPTR,#QUINTA            ;STRING 

0307 120F93         1838             LCALL   MSTRING

030A 22             1839             RET

030B                1840     SEX:

030B B40607         1841             CJNE    A, #06, SAB

030E 9007A3         1842             MOV     DPTR,#SEXTA             ;STRING 

0311 120F93         1843             LCALL   MSTRING

0314 22             1844             RET

0315                1845     SAB:

0315 B40706         1846             CJNE    A, #07, RETORNA

0318 9007A7         1847             MOV     DPTR,#SABADO            ;STRING 

031B 120F93         1848             LCALL   MSTRING

031E                1849     RETORNA:

031E 22             1850             RET

                    1851             

                    1852     

                    1853     

                    1854     

                    1855     

                    1856     

                    1857     

                    1858     

                    1859     

                    1860     

                    1861     

                    1862     

031F                1863     INT_INT0:

031F 32             1864                     RETI

                    1865     

                    1866     

                    1867     

                    1868     

                    1869     

                    1870     

                    1871     

                    1872     

0320                1873     INT_TIMER0:

0320 32             1874                     RETI

                    1875             

                    1876     

                    1877     

                    1878     

                    1879     

                    1880     

                    1881     

                    1882     

0321                1883     INT_INT1:

0321 32             1884                     RETI

                    1885     

                    1886     

                    1887     

                    1888     

                    1889     

                    1890     

                    1891     

                    1892     

0322                1893     INT_TIMER1:

0322 32             1894                     RETI

                    1895             

                    1896     

                    1897     

                    1898     

                    1899     

                    1900     

                    1901     

                    1902     

A51 MACRO ASSEMBLER  PROJETO_03_RFID                                                      05/19/2017 14:59:02 PAGE    30

0323                1903     INT_SERIAL:

0323 32             1904                     RETI

                    1905             

                    1906     

                    1907     

                    1908     

                    1909     

                    1910     

                    1911     

                    1912     

0324                1913     INT_I2C_TWI:

0324 B294           1914                     CPL             P1.4

0326 020800         1915                     LJMP    i2c_int

                    1916     

0329 32             1917                     RETI

                    1918     

                    1919     ;===============================================================================

                    1920     ; Funes do Timer0

                    1921     ;===============================================================================

                    1922     ;------------------------------------------------------------------------------

                    1923     ; Nome: runT0

                    1924     ; Descrio: Gera atraso de tempo utilizando Timer0

                    1925     ; Parmetros: MULT

                    1926     ; Retorna:

                    1927     ; Destri: MULT

                    1928     ;------------------------------------------------------------------------------

032A                1929     runT0:

032A 758CFC         1930         MOV TH0,#0FCh       ;fclk CPU = 24MHz

032D 758A17         1931         MOV TL0,#17h        ; ... base de tempo de 0,5ms

0330 D28C           1932         SETB TR0            ;dispara timer

                    1933     

0332 308DFD         1934         JNB TF0,$           ;preso CLR TR0 ;stop timer

0335 C28C           1935         CLR TR0             ;para o timer 0

0337 C28D           1936         CLR TF0             ;zera flag overflow

0339 D55AEE         1937         DJNZ MULT,runT0

033C 22             1938         RET   

                    1939     

                    1940     ;***************************************************************************

                    1941     ;NOME: Atraso

                    1942     ;DESCRIO: Introduz um atraso (delay) de T = (60 x R0 + 48)/fosc

                    1943     ;       Para fosc = 11,059MHz => R0 = 1 => T = 9,8us  a  R0 = 0 => 1,4ms

                    1944     ;P. ENTRADA: R0 = Valor que multiplica por 60 na frmula (OBS.: R0 = 0 => 256)

                    1945     ;P. SAIDA: -

                    1946     ;Altera: R0

                    1947     ;***************************************************************************

033D                1948     Atraso:

033D 00             1949             NOP                             ;12

033E 00             1950             NOP                             ;12

033F 00             1951             NOP                             ;12

0340 D8FB           1952             DJNZ R0,Atraso  ;24

0342 22             1953             RET                             ;24

                    1954     

                    1955     

                    1956     ;***************************************************************************

                    1957     ;NOME: ATRASO_MS

                    1958     ;DESCRICAO: INTRODUZ UM ATRASO DE 1ms A 256ms

                    1959     ;P.ENTRADA: R2 = 1 => 1ms  A R2 = 0 => 256ms

                    1960     ;P.SAIDA: -

                    1961     ;ALTERA: R0,R2

0343                1962     ATRASO_MS:

0343 78B7           1963             MOV     R0,#183         ;VALOR PARA ATRASO DE 1ms

0345 713D           1964             CALL    Atraso

0347 78B7           1965             MOV     R0,#183         ;VALOR PARA ATRASO DE 1ms

0349 713D           1966             CALL    Atraso

034B DAF6           1967             DJNZ R2,ATRASO_MS

034D 22             1968             RET             

A51 MACRO ASSEMBLER  PROJETO_03_RFID                                                      05/19/2017 14:59:02 PAGE    31

                    1969             

                    1970     

                    1971     END

A51 MACRO ASSEMBLER  PROJETO_03_RFID                                                      05/19/2017 14:59:02 PAGE    32

SYMBOL TABLE LISTING
------ ----- -------


N A M E                        T Y P E  V A L U E   ATTRIBUTES

AA. . . . . . . . . . . . . .  N NUMB   0004H   A   
ACC . . . . . . . . . . . . .  D ADDR   00E0H   A   
ADDR. . . . . . . . . . . . .  N NUMB   005FH   A   
AGAIN . . . . . . . . . . . .  C ADDR   021CH   A   
ARB_LOST. . . . . . . . . . .  C ADDR   0916H   A   
ATRASO. . . . . . . . . . . .  C ADDR   033DH   A   
ATRASO_MS . . . . . . . . . .  C ADDR   0343H   A   
ATUALIZA_DISPLAY. . . . . . .  C ADDR   023CH   A   
AUXR. . . . . . . . . . . . .  D ADDR   008EH   A   
AUXR1 . . . . . . . . . . . .  D ADDR   00A2H   A   
B . . . . . . . . . . . . . .  D ADDR   00F0H   A   
B2R . . . . . . . . . . . . .  N NUMB   005EH   A   
B2W . . . . . . . . . . . . .  N NUMB   005DH   A   
BDRCON. . . . . . . . . . . .  D ADDR   009BH   A   
BRL . . . . . . . . . . . . .  D ADDR   009AH   A   
BUSYF . . . . . . . . . . . .  B ADDR   0080H.7 A   
CCAP0H. . . . . . . . . . . .  D ADDR   00FAH   A   
CCAP0L. . . . . . . . . . . .  D ADDR   00EAH   A   
CCAP1H. . . . . . . . . . . .  D ADDR   00FBH   A   
CCAP1L. . . . . . . . . . . .  D ADDR   00EBH   A   
CCAP2H. . . . . . . . . . . .  D ADDR   00FCH   A   
CCAP2L. . . . . . . . . . . .  D ADDR   00ECH   A   
CCAP3H. . . . . . . . . . . .  D ADDR   00FDH   A   
CCAP3L. . . . . . . . . . . .  D ADDR   00EDH   A   
CCAP4H. . . . . . . . . . . .  D ADDR   00FEH   A   
CCAP4L. . . . . . . . . . . .  D ADDR   00EEH   A   
CCAPM0. . . . . . . . . . . .  D ADDR   00DAH   A   
CCAPM1. . . . . . . . . . . .  D ADDR   00DBH   A   
CCAPM2. . . . . . . . . . . .  D ADDR   00DCH   A   
CCAPM3. . . . . . . . . . . .  D ADDR   00DDH   A   
CCAPM4. . . . . . . . . . . .  D ADDR   00DEH   A   
CCF0. . . . . . . . . . . . .  B ADDR   00D8H.0 A   
CCF1. . . . . . . . . . . . .  B ADDR   00D8H.1 A   
CCF2. . . . . . . . . . . . .  B ADDR   00D8H.2 A   
CCF3. . . . . . . . . . . . .  B ADDR   00D8H.3 A   
CCF4. . . . . . . . . . . . .  B ADDR   00D8H.4 A   
CCON. . . . . . . . . . . . .  D ADDR   00D8H   A   
CF. . . . . . . . . . . . . .  B ADDR   00D8H.7 A   
CH. . . . . . . . . . . . . .  D ADDR   00F9H   A   
CHAMA_TIMER_1_MS. . . . . . .  C ADDR   0D4CH   A   
CHAMA_TIMER_1_S . . . . . . .  C ADDR   0D57H   A   
CHAMA_TIMER_200_MS. . . . . .  C ADDR   0D50H   A   
CKCON0. . . . . . . . . . . .  D ADDR   008FH   A   
CKCON1. . . . . . . . . . . .  D ADDR   00AFH   A   
CKSEL . . . . . . . . . . . .  D ADDR   0085H   A   
CL. . . . . . . . . . . . . .  D ADDR   00E9H   A   
CLR1L . . . . . . . . . . . .  C ADDR   0F48H   A   
CLR1L1. . . . . . . . . . . .  C ADDR   0F52H   A   
CLR2L . . . . . . . . . . . .  C ADDR   0F61H   A   
CLR2L1. . . . . . . . . . . .  C ADDR   0F6BH   A   
CMOD. . . . . . . . . . . . .  D ADDR   00D9H   A   
CONFIGURA_BAUD_RATE . . . . .  C ADDR   0A09H   A   
CONFIGURA_SERIAL. . . . . . .  C ADDR   0A00H   A   
CONTINUA_ENVIAR . . . . . . .  C ADDR   00C7H   A   
CONTINUA_TIMER_1_MS . . . . .  C ADDR   0D1FH   A   
CONVERTE_BCD. . . . . . . . .  C ADDR   022EH   A   
CP_RL2. . . . . . . . . . . .  B ADDR   00C8H.0 A   
CR. . . . . . . . . . . . . .  B ADDR   00D8H.6 A   
CTR . . . . . . . . . . . . .  N NUMB   0057H   A   
CUR1. . . . . . . . . . . . .  C ADDR   0FBFH   A   
A51 MACRO ASSEMBLER  PROJETO_03_RFID                                                      05/19/2017 14:59:02 PAGE    33

CUR_OFF . . . . . . . . . . .  C ADDR   0FBDH   A   
CUR_ON. . . . . . . . . . . .  C ADDR   0FB9H   A   
C_T2. . . . . . . . . . . . .  B ADDR   00C8H.1 A   
DAT . . . . . . . . . . . . .  N NUMB   0054H   A   
DAY . . . . . . . . . . . . .  N NUMB   0053H   A   
DBASE . . . . . . . . . . . .  N NUMB   0060H   A   
DECODE. . . . . . . . . . . .  C ADDR   0887H   A   
DISPLAY . . . . . . . . . . .  D ADDR   0080H   A   
DOMINGO . . . . . . . . . . .  C ADDR   078FH   A   
DPH . . . . . . . . . . . . .  D ADDR   0083H   A   
DPL . . . . . . . . . . . . .  D ADDR   0082H   A   
EA. . . . . . . . . . . . . .  B ADDR   00A8H.7 A   
EC. . . . . . . . . . . . . .  B ADDR   00A8H.6 A   
EECON . . . . . . . . . . . .  D ADDR   00D2H   A   
EHOSW2. . . . . . . . . . . .  C ADDR   00A9H   A   
END_GET . . . . . . . . . . .  C ADDR   078EH   A   
END_I2C_INT . . . . . . . . .  C ADDR   0886H   A   
END_SET . . . . . . . . . . .  C ADDR   075EH   A   
ENVIA_DADO. . . . . . . . . .  C ADDR   0A18H   A   
ENVIA_OK. . . . . . . . . . .  C ADDR   0A20H   A   
EP0INT. . . . . . . . . . . .  B ADDR   00F8H.0 A   
EP1INT. . . . . . . . . . . .  B ADDR   00F8H.1 A   
EP2INT. . . . . . . . . . . .  B ADDR   00F8H.2 A   
EP3INT. . . . . . . . . . . .  B ADDR   00F8H.3 A   
EP4INT. . . . . . . . . . . .  B ADDR   00F8H.4 A   
EP5INT. . . . . . . . . . . .  B ADDR   00F8H.5 A   
EP6INT. . . . . . . . . . . .  B ADDR   00F8H.6 A   
ERRO. . . . . . . . . . . . .  C ADDR   089CH   A   
ES. . . . . . . . . . . . . .  B ADDR   00A8H.4 A   
ESCDADO . . . . . . . . . . .  C ADDR   0F7AH   A   
ESCINST . . . . . . . . . . .  C ADDR   0F1FH   A   
ESCREVE_ASTERISCO . . . . . .  C ADDR   0FC4H   A   
ESC_S . . . . . . . . . . . .  C ADDR   0FB2H   A   
ESC_STR1. . . . . . . . . . .  C ADDR   0FA8H   A   
ESC_STR2. . . . . . . . . . .  C ADDR   0FAEH   A   
ESPERA_DADOS. . . . . . . . .  C ADDR   0070H   A   
ET0 . . . . . . . . . . . . .  B ADDR   00A8H.1 A   
ET1 . . . . . . . . . . . . .  B ADDR   00A8H.3 A   
ET2 . . . . . . . . . . . . .  B ADDR   00A8H.5 A   
EX0 . . . . . . . . . . . . .  B ADDR   00A8H.0 A   
EX1 . . . . . . . . . . . . .  B ADDR   00A8H.2 A   
EXEN2 . . . . . . . . . . . .  B ADDR   00C8H.3 A   
EXF2. . . . . . . . . . . . .  B ADDR   00C8H.6 A   
E_LCD . . . . . . . . . . . .  B ADDR   00A0H.7 A   
FCON. . . . . . . . . . . . .  D ADDR   00D1H   A   
FE_SM0. . . . . . . . . . . .  B ADDR   0098H.7 A   
FINALIZA_TIMER_DELAY. . . . .  C ADDR   0D61H   A   
GET_WAIT. . . . . . . . . . .  C ADDR   077DH   A   
GOTOXY. . . . . . . . . . . .  C ADDR   0F36H   A   
GT1 . . . . . . . . . . . . .  C ADDR   0F3FH   A   
HOU . . . . . . . . . . . . .  N NUMB   0052H   A   
I2C_BUSY. . . . . . . . . . .  N NUMB   0000H   A   
I2C_INT . . . . . . . . . . .  C ADDR   0800H   A   
I2C_SCL . . . . . . . . . . .  B ADDR   00C0H.0 A   
I2C_SDA . . . . . . . . . . .  B ADDR   00C0H.1 A   
IE0_. . . . . . . . . . . . .  B ADDR   0088H.1 A   
IE1_. . . . . . . . . . . . .  B ADDR   0088H.3 A   
IEN0. . . . . . . . . . . . .  D ADDR   00A8H   A   
IEN1. . . . . . . . . . . . .  D ADDR   00B1H   A   
INIDISP . . . . . . . . . . .  C ADDR   0F00H   A   
INIT_RTC. . . . . . . . . . .  C ADDR   0700H   A   
INT_I2C_TWI . . . . . . . . .  C ADDR   0324H   A   
INT_INT0. . . . . . . . . . .  C ADDR   031FH   A   
INT_INT1. . . . . . . . . . .  C ADDR   0321H   A   
INT_SERIAL. . . . . . . . . .  C ADDR   0323H   A   
INT_TIMER0. . . . . . . . . .  C ADDR   0320H   A   
A51 MACRO ASSEMBLER  PROJETO_03_RFID                                                      05/19/2017 14:59:02 PAGE    34

INT_TIMER1. . . . . . . . . .  C ADDR   0322H   A   
IPH0. . . . . . . . . . . . .  D ADDR   00B7H   A   
IPH1. . . . . . . . . . . . .  D ADDR   00B3H   A   
IPL0. . . . . . . . . . . . .  D ADDR   00B8H   A   
IPL1. . . . . . . . . . . . .  D ADDR   00B2H   A   
IT0 . . . . . . . . . . . . .  B ADDR   0088H.0 A   
IT1 . . . . . . . . . . . . .  B ADDR   0088H.2 A   
KBE . . . . . . . . . . . . .  D ADDR   009DH   A   
KBF . . . . . . . . . . . . .  D ADDR   009EH   A   
KBLS. . . . . . . . . . . . .  D ADDR   009CH   A   
LEDCON. . . . . . . . . . . .  D ADDR   00F1H   A   
LOOP. . . . . . . . . . . . .  C ADDR   0206H   A   
LSB . . . . . . . . . . . . .  N NUMB   0058H   A   
MAIN. . . . . . . . . . . . .  C ADDR   006DH   A   
MIN . . . . . . . . . . . . .  N NUMB   0051H   A   
MON . . . . . . . . . . . . .  N NUMB   0055H   A   
MSB . . . . . . . . . . . . .  N NUMB   0059H   A   
MSTR1 . . . . . . . . . . . .  C ADDR   0F9DH   A   
MSTR21. . . . . . . . . . . .  C ADDR   0FA7H   A   
MSTRING . . . . . . . . . . .  C ADDR   0F93H   A   
MSTRINGX. . . . . . . . . . .  C ADDR   0F9EH   A   
MULT. . . . . . . . . . . . .  N NUMB   005AH   A   
NACKS . . . . . . . . . . . .  N NUMB   0061H   A   
NOT_IMPL. . . . . . . . . . .  C ADDR   0886H   A   
P0. . . . . . . . . . . . . .  D ADDR   0080H   A   
P0_0. . . . . . . . . . . . .  B ADDR   0080H.0 A   
P0_1. . . . . . . . . . . . .  B ADDR   0080H.1 A   
P0_2. . . . . . . . . . . . .  B ADDR   0080H.2 A   
P0_3. . . . . . . . . . . . .  B ADDR   0080H.3 A   
P0_4. . . . . . . . . . . . .  B ADDR   0080H.4 A   
P0_5. . . . . . . . . . . . .  B ADDR   0080H.5 A   
P0_6. . . . . . . . . . . . .  B ADDR   0080H.6 A   
P0_7. . . . . . . . . . . . .  B ADDR   0080H.7 A   
P1. . . . . . . . . . . . . .  D ADDR   0090H   A   
P1_0. . . . . . . . . . . . .  B ADDR   0090H.0 A   
P1_1. . . . . . . . . . . . .  B ADDR   0090H.1 A   
P1_2. . . . . . . . . . . . .  B ADDR   0090H.2 A   
P1_3. . . . . . . . . . . . .  B ADDR   0090H.3 A   
P1_4. . . . . . . . . . . . .  B ADDR   0090H.4 A   
P1_5. . . . . . . . . . . . .  B ADDR   0090H.5 A   
P1_6. . . . . . . . . . . . .  B ADDR   0090H.6 A   
P1_7. . . . . . . . . . . . .  B ADDR   0090H.7 A   
P2. . . . . . . . . . . . . .  D ADDR   00A0H   A   
P2_0. . . . . . . . . . . . .  B ADDR   00A0H.0 A   
P2_1. . . . . . . . . . . . .  B ADDR   00A0H.1 A   
P2_2. . . . . . . . . . . . .  B ADDR   00A0H.2 A   
P2_3. . . . . . . . . . . . .  B ADDR   00A0H.3 A   
P2_4. . . . . . . . . . . . .  B ADDR   00A0H.4 A   
P2_5. . . . . . . . . . . . .  B ADDR   00A0H.5 A   
P2_6. . . . . . . . . . . . .  B ADDR   00A0H.6 A   
P2_7. . . . . . . . . . . . .  B ADDR   00A0H.7 A   
P3. . . . . . . . . . . . . .  D ADDR   00B0H   A   
P3_0. . . . . . . . . . . . .  B ADDR   00B0H.0 A   
P3_1. . . . . . . . . . . . .  B ADDR   00B0H.1 A   
P3_2. . . . . . . . . . . . .  B ADDR   00B0H.2 A   
P3_3. . . . . . . . . . . . .  B ADDR   00B0H.3 A   
P3_4. . . . . . . . . . . . .  B ADDR   00B0H.4 A   
P3_5. . . . . . . . . . . . .  B ADDR   00B0H.5 A   
P3_6. . . . . . . . . . . . .  B ADDR   00B0H.6 A   
P3_7. . . . . . . . . . . . .  B ADDR   00B0H.7 A   
P4. . . . . . . . . . . . . .  D ADDR   00C0H   A   
P4_0. . . . . . . . . . . . .  B ADDR   00C0H.0 A   
P4_1. . . . . . . . . . . . .  B ADDR   00C0H.1 A   
PCON. . . . . . . . . . . . .  D ADDR   0087H   A   
PLLCON. . . . . . . . . . . .  D ADDR   00A3H   A   
PLLDIV. . . . . . . . . . . .  D ADDR   00A4H   A   
A51 MACRO ASSEMBLER  PROJETO_03_RFID                                                      05/19/2017 14:59:02 PAGE    35

PPCL. . . . . . . . . . . . .  B ADDR   00B8H.6 A   
PSL . . . . . . . . . . . . .  B ADDR   00B8H.4 A   
PSW . . . . . . . . . . . . .  D ADDR   00D0H   A   
PT0L. . . . . . . . . . . . .  B ADDR   00B8H.1 A   
PT2L. . . . . . . . . . . . .  B ADDR   00B8H.5 A   
PTIL. . . . . . . . . . . . .  B ADDR   00B8H.3 A   
PX0L. . . . . . . . . . . . .  B ADDR   00B8H.0 A   
PXIL. . . . . . . . . . . . .  B ADDR   00B8H.2 A   
QUA . . . . . . . . . . . . .  C ADDR   02F7H   A   
QUARTA. . . . . . . . . . . .  C ADDR   079BH   A   
QUI . . . . . . . . . . . . .  C ADDR   0301H   A   
QUINTA. . . . . . . . . . . .  C ADDR   079FH   A   
RAA1. . . . . . . . . . . . .  C ADDR   0924H   A   
RAA2. . . . . . . . . . . . .  C ADDR   0926H   A   
RADDR . . . . . . . . . . . .  N NUMB   00D1H   A   
RB8 . . . . . . . . . . . . .  B ADDR   0098H.2 A   
RCAP2H. . . . . . . . . . . .  D ADDR   00CBH   A   
RCAP2L. . . . . . . . . . . .  D ADDR   00CAH   A   
RCLK. . . . . . . . . . . . .  B ADDR   00C8H.5 A   
RDA1. . . . . . . . . . . . .  C ADDR   0949H   A   
RDA2. . . . . . . . . . . . .  C ADDR   094BH   A   
RECEBE_DADO . . . . . . . . .  C ADDR   0A10H   A   
RELOAD. . . . . . . . . . . .  C ADDR   021AH   A   
REN . . . . . . . . . . . . .  B ADDR   0098H.4 A   
RESTART . . . . . . . . . . .  C ADDR   08B5H   A   
RETORNA . . . . . . . . . . .  C ADDR   031EH   A   
RI. . . . . . . . . . . . . .  B ADDR   0098H.0 A   
RS. . . . . . . . . . . . . .  B ADDR   00A0H.5 A   
RTC_GET_TIME. . . . . . . . .  C ADDR   075FH   A   
RTC_SET_TIME. . . . . . . . .  C ADDR   072FH   A   
RTC_SQW . . . . . . . . . . .  B ADDR   00A0H.1 A   
RUNT0 . . . . . . . . . . . .  C ADDR   032AH   A   
RW. . . . . . . . . . . . . .  B ADDR   00A0H.6 A   
R_ADDR_ACK. . . . . . . . . .  C ADDR   0919H   A   
R_ADDR_NACK . . . . . . . . .  C ADDR   092BH   A   
R_DATA_ACK. . . . . . . . . .  C ADDR   093AH   A   
R_DATA_NACK . . . . . . . . .  C ADDR   0952H   A   
SAB . . . . . . . . . . . . .  C ADDR   0315H   A   
SABADO. . . . . . . . . . . .  C ADDR   07A7H   A   
SADDR . . . . . . . . . . . .  D ADDR   00A9H   A   
SADEN . . . . . . . . . . . .  D ADDR   00B9H   A   
SBUF. . . . . . . . . . . . .  D ADDR   0099H   A   
SCON. . . . . . . . . . . . .  D ADDR   0098H   A   
SEC . . . . . . . . . . . . .  N NUMB   0050H   A   
SEGU. . . . . . . . . . . . .  C ADDR   02E3H   A   
SEGUNDA . . . . . . . . . . .  C ADDR   0793H   A   
SETA_VALORES_TIMER_SEM_INT. .  C ADDR   0D05H   A   
SET_WAIT. . . . . . . . . . .  C ADDR   074DH   A   
SEX . . . . . . . . . . . . .  C ADDR   030BH   A   
SEXTA . . . . . . . . . . . .  C ADDR   07A3H   A   
SI. . . . . . . . . . . . . .  N NUMB   0008H   A   
SM1 . . . . . . . . . . . . .  B ADDR   0098H.6 A   
SM2 . . . . . . . . . . . . .  B ADDR   0098H.5 A   
SP. . . . . . . . . . . . . .  D ADDR   0081H   A   
SPCON . . . . . . . . . . . .  D ADDR   00C3H   A   
SPDAT . . . . . . . . . . . .  D ADDR   00C5H   A   
SPSTA . . . . . . . . . . . .  D ADDR   00C4H   A   
SSADR . . . . . . . . . . . .  D ADDR   0096H   A   
SSCON . . . . . . . . . . . .  D ADDR   0093H   A   
SSCS. . . . . . . . . . . . .  D ADDR   0094H   A   
SSDAT . . . . . . . . . . . .  D ADDR   0095H   A   
SSIE. . . . . . . . . . . . .  N NUMB   0040H   A   
STA . . . . . . . . . . . . .  N NUMB   0020H   A   
START . . . . . . . . . . . .  C ADDR   08A7H   A   
STO . . . . . . . . . . . . .  N NUMB   0010H   A   
T2CON . . . . . . . . . . . .  D ADDR   00C8H   A   
A51 MACRO ASSEMBLER  PROJETO_03_RFID                                                      05/19/2017 14:59:02 PAGE    36

T2MOD . . . . . . . . . . . .  D ADDR   00C9H   A   
TANORMAL. . . . . . . . . . .  C ADDR   0218H   A   
TB8 . . . . . . . . . . . . .  B ADDR   0098H.3 A   
TCLK. . . . . . . . . . . . .  B ADDR   00C8H.4 A   
TCON. . . . . . . . . . . . .  D ADDR   0088H   A   
TER . . . . . . . . . . . . .  C ADDR   02EDH   A   
TERCA . . . . . . . . . . . .  C ADDR   0797H   A   
TERMINA . . . . . . . . . . .  C ADDR   0897H   A   
TF0 . . . . . . . . . . . . .  B ADDR   0088H.5 A   
TF1 . . . . . . . . . . . . .  B ADDR   0088H.7 A   
TF2 . . . . . . . . . . . . .  B ADDR   00C8H.7 A   
TH0 . . . . . . . . . . . . .  D ADDR   008CH   A   
TH1 . . . . . . . . . . . . .  D ADDR   008DH   A   
TH2 . . . . . . . . . . . . .  D ADDR   00CDH   A   
TI. . . . . . . . . . . . . .  B ADDR   0098H.1 A   
TIMER_CONFIGURA_TIMER_SEM_INT  C ADDR   0D00H   A   
TIMER_DELAY . . . . . . . . .  C ADDR   0D3DH   A   
TIMER_DELAY_10_US . . . . . .  C ADDR   0D0EH   A   
TIMER_DELAY_1_MS. . . . . . .  C ADDR   0D13H   A   
TIMER_DELAY_1_S . . . . . . .  C ADDR   0D36H   A   
TIMER_DELAY_200_MS. . . . . .  C ADDR   0D2FH   A   
TL0 . . . . . . . . . . . . .  D ADDR   008AH   A   
TL1 . . . . . . . . . . . . .  D ADDR   008BH   A   
TL2 . . . . . . . . . . . . .  D ADDR   00CCH   A   
TMOD. . . . . . . . . . . . .  D ADDR   0089H   A   
TR0 . . . . . . . . . . . . .  B ADDR   0088H.4 A   
TR1 . . . . . . . . . . . . .  B ADDR   0088H.6 A   
TR2 . . . . . . . . . . . . .  B ADDR   00C8H.2 A   
T_OUT . . . . . . . . . . . .  N NUMB   005BH   A   
T_OUTS. . . . . . . . . . . .  N NUMB   005CH   A   
UBYCTHX . . . . . . . . . . .  D ADDR   00E3H   A   
UBYCTLX . . . . . . . . . . .  D ADDR   00E2H   A   
UDPADDH . . . . . . . . . . .  D ADDR   00D7H   A   
UDPADDL . . . . . . . . . . .  D ADDR   00D6H   A   
UEPCONX . . . . . . . . . . .  D ADDR   00D4H   A   
UEPDATX . . . . . . . . . . .  D ADDR   00CFH   A   
UEPIEN. . . . . . . . . . . .  D ADDR   00C2H   A   
UEPINT. . . . . . . . . . . .  D ADDR   00F8H   A   
UEPNUM. . . . . . . . . . . .  D ADDR   00C7H   A   
UEPRST. . . . . . . . . . . .  D ADDR   00D5H   A   
UEPSTAX . . . . . . . . . . .  D ADDR   00CEH   A   
UFNUMH. . . . . . . . . . . .  D ADDR   00BBH   A   
UFNUML. . . . . . . . . . . .  D ADDR   00BAH   A   
USBADDR . . . . . . . . . . .  D ADDR   00C6H   A   
USBCON. . . . . . . . . . . .  D ADDR   00BCH   A   
USBIEN. . . . . . . . . . . .  D ADDR   00BEH   A   
USBINT. . . . . . . . . . . .  D ADDR   00BDH   A   
VERIFICA_R0 . . . . . . . . .  C ADDR   0D47H   A   
VERIFICA_R1 . . . . . . . . .  C ADDR   0D44H   A   
WADDR . . . . . . . . . . . .  N NUMB   00D0H   A   
WDA1. . . . . . . . . . . . .  C ADDR   08FAH   A   
WDA2. . . . . . . . . . . . .  C ADDR   08EFH   A   
WDTPRG. . . . . . . . . . . .  D ADDR   00A7H   A   
WDTRST. . . . . . . . . . . .  D ADDR   00A6H   A   
W_ADDR_ACK. . . . . . . . . .  C ADDR   08C1H   A   
W_ADDR_NACK . . . . . . . . .  C ADDR   08CDH   A   
W_DATA_ACK. . . . . . . . . .  C ADDR   08DCH   A   
W_DATA_NACK . . . . . . . . .  C ADDR   0909H   A   
YEA . . . . . . . . . . . . .  N NUMB   0056H   A   
__STARTUP__ . . . . . . . . .  C ADDR   0046H   A   


REGISTER BANK(S) USED: 0 


ASSEMBLY COMPLETE.  0 WARNING(S), 0 ERROR(S)
